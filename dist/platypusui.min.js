var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},platui;!function(a){"use strict";var b="$",c=b+"Promise",d=b+"Compat",e=b+"Regex",f=b+"Window",g=b+"Document",h=b+"Animator",i=b+"DomEventInstance",j=b+"TemplateControlFactory",k="plat",l=k+"-",m=l+"button",n=l+"checkbox",o=l+"drawer",p=o+"-controller",q=l+"modal",r=l+"progress",s=l+"ring",t=l+"radio",u=l+"toggle",v=l+"slider",w=l+"range",x=l+"select",y=l+"input",z=l+"file",A=l+"carousel",B=l+"listview",C=l+"hide",D=l+"checked",E=l+"bind",F=l+"disabled",G=k+"Checked",H=k+"Bind",I={index:"index",even:"even",odd:"odd",first:"first",last:"last",group:"group"},J=l+"transition",K=l+"enter",L=l+"leave",M="$tap",N="$touchstart",O="$touchend",P="$touchcancel",Q="$swipe",R="$track",S="$trackend",T="__plat-button-",U="__plat-radio-",V="__platDrawerControllerFetch",W="__platDrawerFound",X="__platDrawerControllerDisposing",Y="__platDrawerControllerDisposingFound",Z="-reversed",$="literal",_={right:"left",left:"right",up:"down",down:"up"},aa=function(){};"undefined"!=typeof window&&("undefined"==typeof window.platui&&(window.platui=a),"undefined"==typeof window.module&&(window.module={}));var ba=function(a){function b(){a.apply(this,arguments),this.replaceWith="button",this._isSelected=!1}return __extends(b,a),b.prototype.setClasses=function(a,b){this.dom.addClass(b||this.element,m+" "+(a||""))},b.prototype.initialize=function(){this.setClasses()},b.prototype.setTemplate=function(){for(var a,b,c=this._document,d=this.element,e=Array.prototype.slice.call(d.childNodes),f=this.utils.isEmpty;e.length>0;)a=e.shift(),a.nodeType===Node.TEXT_NODE?f(a.textContent.trim().match(/[^\r\n]/g))||(b=c.createElement("span"),b.insertBefore(a,null),d.insertBefore(b,null)):d.insertBefore(a,null)},b.prototype.loaded=function(){var a=this.element,b=this.options||{},c=b.value||{},d=c.group,e=this.utils.isString;return e(d)?(this._group=d,this.dom.hasClass(a,l+"selected")&&this._onTap(),void this._addEventListeners()):(d=this.attributes[H],void(e(d)&&(this._group=d,this.dom.hasClass(a,l+"selected")&&this._onTap(),this._addEventListeners())))},b.prototype._addEventListeners=function(){var a=this;this.addEventListener(this.element,M,this._onTap,!1),this.on(T+this._group,function(){a._isSelected&&(a.dom.removeClass(a.element,l+"selected"),a._isSelected=!1)})},b.prototype._onTap=function(){if(!this._isSelected){var a=this.element;this.dom.addClass(a,l+"selected"),this.dispatchEvent(T+this._group,plat.events.EventManager.DIRECT),this._isSelected=!0,this.inputChanged(a.textContent)}},b._inject={_document:g},b}(plat.ui.BindControl);a.Button=ba,plat.register.control(m,ba);var ca=function(a){function b(){a.apply(this,arguments),this.templateString='<div class="plat-toggle-container">\n    <div class="plat-knob"></div>\n</div>\n',this.isActive=!1,this._targetType="slide"}return __extends(b,a),b.prototype.setClasses=function(a,b){this.dom.addClass(b||this.element,u+" "+(a||""))},b.prototype.initialize=function(){this.setClasses()},b.prototype.loaded=function(){var a=this.element;this._targetElement=a.firstElementChild,this.addEventListener(a,M,this._onTap)},b.prototype.observeProperties=function(a){a.observeProperty(this._setBoundProperty)},b.prototype._setBoundProperty=function(a,b,c,d){if(a!==b){if(d===!0&&this.utils.isNull(a))return void this.inputChanged(this.isActive);var e=!!a;e!==this.isActive&&this._toggle(d)}},b.prototype._onTap=function(a){this._toggle(!0),this._trigger("change")},b.prototype._trigger=function(a){var b=plat.acquire(i);b.initialize(this.element,a),b.trigger()},b.prototype._toggle=function(a){var b=this.isActive,c=!b;this._activate(this._targetElement||(this._targetElement=this.element.firstElementChild)),this.isActive=this.element.checked=c,a===!0&&this.inputChanged(c,b)},b.prototype._activate=function(a){this.dom.toggleClass(a,l+this._targetType)},b}(plat.ui.BindControl);a.Toggle=ca,plat.register.control(u,ca);var da=function(a){function b(){a.apply(this,arguments),this.templateString='<div class="plat-checkbox-container">\n    <span class="plat-mark"></span>\n</div>\n',this._targetTypeSet=!1}return __extends(b,a),b.prototype.setClasses=function(a,b){this.dom.addClass(b||this.element,n+" "+(a||""))},b.prototype.setTemplate=function(){var a=this.utils.isNull,b=this.innerTemplate;if(!a(b))for(var c,d,e,f=this._document,g=this.element,h=Array.prototype.slice.call(b.childNodes);h.length>0;)c=h.shift(),c.nodeType===Node.TEXT_NODE?(e=c.textContent.trim().match(/[^\r\n]/g),null!==e&&e.length>0&&(d=f.createElement("span"),d.insertBefore(c,null),g.insertBefore(d,null))):g.insertBefore(c,null)},b.prototype.loaded=function(){a.prototype.loaded.call(this);var b=this.options||{},c=b.value||{},d=this._targetType,e=this._targetType=c.mark||"check";switch(this._convertChecked(),e.toLowerCase()){case"check":case"x":break;default:var f=this._Exception;f.warn("Invalid mark option specified for"+this.type+". Defaulting to checkmark.",f.CONTROL),this._targetType="check"}if(this._targetTypeSet){var g=this._targetElement;this.dom.removeClass(g,d),this._activate(g)}this._targetTypeSet=!0},b.prototype._convertChecked=function(){var a=this.element;a.hasAttribute(D)?(this._convertAttribute(a.getAttribute(D)),this.attributes.observe(this._convertAttribute,G)):a.hasAttribute("data-"+D)?(this._convertAttribute(a.getAttribute("data-"+D)),this.attributes.observe(this._convertAttribute,G)):(a.hasAttribute("checked")||a.hasAttribute("data-checked"))&&this._convertAttribute(!0)},b.prototype._convertAttribute=function(a,b){var c=this.utils;return c.isBoolean(a)?this._setBoundProperty(a,b,null,!0):void(c.isString(a)&&this._setBoundProperty("true"===a,"true"===b,null,!0))},b.prototype._activate=function(a){return this._targetTypeSet?void this.dom.toggleClass(a,l+this._targetType):void(this._targetTypeSet=!0)},b._inject={_document:g},b}(ca);a.Checkbox=da,plat.register.control(n,da);var ea=function(a){function b(){a.apply(this,arguments),this.templateString='<div class="plat-radio-container">\n    <div class="plat-mark"></div>\n</div>\n',this.groupName="",this._targetType="bullet",this._targetTypeSet=!0}return __extends(b,a),b.prototype.setClasses=function(a,b){this.dom.addClass(b||this.element,t+" "+(a||""))},b.prototype.loaded=function(){var a=this.element;this._targetElement=a.firstElementChild,this.addEventListener(a,M,this._onTap),a.hasAttribute("name")?this.groupName=a.getAttribute("name"):a.hasAttribute(E)?this.groupName=a.getAttribute(E):a.hasAttribute("data-"+E)&&(this.groupName=a.getAttribute("data-"+E)),this._convertChecked()},b.prototype.inputChanged=function(b,c){this.isActive&&a.prototype.inputChanged.call(this,this._getValue())},b.prototype._setBoundProperty=function(a,b,c,d){if(a!==b){if(d===!0&&this.utils.isNull(a))return void this.inputChanged();var e=a===this._getValue(),f=this.isActive;e!==f&&this._toggle(d)}},b.prototype._onTap=function(b){this.isActive||a.prototype._onTap.call(this,b)},b.prototype._toggle=function(b){var c=this;if(a.prototype._toggle.call(this,b),this.utils.isFunction(this._removeListener)&&(this._removeListener(),this._removeListener=null),this.isActive){var d=this.groupName;this.dispatchEvent(U+d,plat.events.EventManager.DIRECT);var e=this._removeListener=this.on(U+d,function(){c._toggle(),e()})}},b.prototype._convertAttribute=function(a,b){var c=this.utils;return c.isBoolean(a)?void(a&&this._setBoundProperty(this._getValue(),null,null,!0)):void(c.isString(a)&&"true"===a&&this._setBoundProperty(this._getValue(),null,null,!0))},b.prototype._getValue=function(){var a=this.element;return a.hasAttribute("value")?a.getAttribute("value").trim():a.textContent.trim()},b}(da);a.Radio=ea,plat.register.control(t,ea);var fa=function(a){function b(){a.apply(this,arguments),this.templateString='<div class="plat-progress-container">\n    <div class="plat-animated-ring"></div>\n</div>\n'}return __extends(b,a),b.prototype.setClasses=function(a,b){this.dom.addClass(b||this.element,s+" "+(a||""))},b.prototype.initialize=function(){this.setClasses()},b}(plat.ui.TemplateControl);a.ProgressRing=fa,plat.register.control(s,fa);var ga=function(a){function b(){a.apply(this,arguments),this.templateString='<div class="plat-progress-container">\n    <div class="plat-animated-bar"></div>\n</div>\n'}return __extends(b,a),b.prototype.setClasses=function(a,b){this.dom.addClass(b||this.element,r+" "+(a||""))},b.prototype.initialize=function(){this.setClasses()},b.prototype.loaded=function(){var a=this;this._barElement=this.element.firstElementChild.firstElementChild,this.setProgress(this.context),this.addEventListener(this._window,"resize",function(){a.setProgress(a.context)})},b.prototype.contextChanged=function(){this.setProgress(this.context)},b.prototype.setProgress=function(a){if(!this.utils.isNumber(a)||a>1||0>a){var b=this._Exception;return void b.warn('The context of a "'+this.type+'" control must be a number between 0 and 1.',b.CONTEXT)}var c=this._barElement,d=c.parentElement.offsetWidth;d&&(c.style.width=Math.ceil(d*a)+"px")},b._inject={_window:f},b}(plat.ui.TemplateControl);a.ProgressBar=ga,plat.register.control(r,ga);var ha=function(a){function b(){a.apply(this,arguments),this._controllers=[],this._isInitialized=!1,this._preInitializedValue=!1}return __extends(b,a),b.prototype.setClasses=function(a,b){this.dom.addClass(b||this.element,o+" "+(a||""))},b.prototype.initialize=function(){this.setClasses()},b.prototype.setTemplate=function(){this.innerTemplate=this.dom.appendChildren(this.element.childNodes)},b.prototype.loaded=function(){var a=this,b=this.element,c=this.utils,d=this.options||{},e=d.value||{},f=this._currentPosition=e.position||"left",g=e.id||"",h=e.templateUrl,i=e.elastic===!0;return b.setAttribute(C,""),this.dom.addClass(b,l+f),c.isString(h)?void plat.ui.TemplateControl.determineTemplate(this,h).then(function(b){a.innerTemplate=b,a._initializeEvents(g,f,i)}):void this._initializeEvents(g,f,i)},b.prototype.open=function(){var a=this._controllers[0];if(this.utils.isNull(a)){var b=this._Exception;return b.warn("No controller, such as a "+p+", found for the "+this.type+" attempting to open.",b.TEMPLATE),this._Promise.resolve(null)}return a.open()},b.prototype.close=function(){var a=this._controllers[0];if(this.utils.isNull(a)){var b=this._Exception;return b.warn("No controller, such as a "+p+", found for the "+this.type+" attempting to close.",b.TEMPLATE),this._Promise.resolve(null)}return a.close()},b.prototype.toggle=function(){var a=this._controllers[0];if(this.utils.isNull(a)){var b=this._Exception;return b.warn("No controller, such as a "+p+", found for the "+this.type+" attempting to toggle.",b.TEMPLATE),this._Promise.resolve(null)}return a.toggle()},b.prototype.reset=function(){var a=this._controllers[0];if(this.utils.isNull(a)){var b=this._Exception;return b.warn("No controller, such as a "+p+", found for the "+this.type+" attempting to reset.",b.TEMPLATE),this._Promise.resolve(null)}return a.reset()},b.prototype.isOpen=function(){var a=this._controllers[0];if(this.utils.isNull(a)){var b=this._Exception;return b.warn("No controller, such as a "+p+", found for the "+this.type+" attempting to check if open.",b.TEMPLATE),!1}return a.isOpen()},b.prototype.bindTemplate=function(a,b){var c=this,d=this.bindableTemplates;return d.add(a,b),d.bind(a).then(function(a){var b=c.element;c.dom.clearNode(b),b.appendChild(a)}).catch(function(a){var b=c._Exception;b.warn("Error binding template for "+c.type+": "+a,b.BIND)})},b.prototype.controllerCount=function(){return this._controllers.length},b.prototype.spliceController=function(a){var b=this._controllers,c=b.indexOf(a);-1!==c&&b.splice(c,1)},b.prototype.observeProperties=function(a){a.observeProperty(this._setBoundProperty)},b.prototype._setBoundProperty=function(a,b,c,d){var e=this.utils,f=this._controllers[0];if(d===!0&&e.isNull(a))return void this.inputChanged(e.isNull(f)?!1:f.isOpen());if(e.isBoolean(a)){if(!this._isInitialized)return void(this._preInitializedValue=a);if(this._preInitializedValue=!1,e.isNull(f))return;if(a){if(f.isOpen())return;return void f.open()}return void(f.isOpen()&&f.close())}var g=this._Exception;g.warn("Attempting to open or close "+this.type+" with a bound value that is something other than a boolean.",g.BIND)},b.prototype._changeDirection=function(a){if(!this.utils.isNull(a)&&a!==this._currentPosition){var b=this.dom,c=this.element;b.removeClass(c,l+this._currentPosition),b.addClass(c,l+a),this._currentPosition=a}},b.prototype._initializeEvents=function(a,b,c){var d=this,e=this.utils,f=this.innerTemplate;this.on(V+"_"+a,function(g,h){var i=h.control;if(!e.isNull(i))return e.isString(h.position)&&(b=h.position,d._changeDirection(b)),d._controllers.unshift(i),h.received||d.dispatchEvent(W+"_"+a,plat.events.EventManager.DIRECT,{control:d,received:!0,position:b,template:e.isNode(f)?f.cloneNode(!0):null,elastic:c}),d._isInitialized=!0,h.useContext?void d._checkPreInit():void d.bindTemplate("drawer",f.cloneNode(!0)).then(function(){d._checkPreInit()})}),this.dispatchEvent(W+"_"+a,plat.events.EventManager.DIRECT,{control:this,received:!1,position:b,template:e.isNode(f)?f.cloneNode(!0):null,elastic:c})},b.prototype._checkPreInit=function(){var a=this;if(this._preInitializedValue){var b=this.utils;b.postpone(function(){var c=a._controllers[0];b.isNull(c)||c.open()})}},b._inject={_Promise:c},b}(plat.ui.BindControl);a.Drawer=ha,plat.register.control(o,ha);var ia=function(a){function b(){a.apply(this,arguments),this._hasSwiped=!1,this._hasTapped=!1,this._isOpen=!1,this._touchState=0,this._isVertical=!1,this._disposeRemover=aa,this._isInitialized=!1,this._preInitializedValue=!1}return __extends(b,a),b.prototype.initialize=function(){this.dom.addClass(this.element,p)},b.prototype.loaded=function(){var a=this.options||{},b=a.value||{},c=b.position,d=b.id||"";this._type=b.type||"tap track",this._isElastic=b.elastic,this._useContext=b.useContext===!0,this._templateUrl=b.templateUrl,this._initializeEvents(d,c)},b.prototype.dispose=function(){var b=this;a.prototype.dispose.call(this);var c=this.utils,d=this._drawer;if(!(c.isNull(d)||(d.spliceController(this),d.controllerCount()>0))){var e=d.storedProperties,f=this._rootElement,g=!0;this._disposeRemover(),this.on(Y,function(a,b){g&&(g=f!==b)}),c.defer(function(){if(g&&(b.dom.removeClass(f,o+"-open plat-drawer-transition-prep "+b._directionalTransitionPrep),c.isObject(e))){var a=f.style,d=f.parentElement,h=e.parentOverflow;a.position=e.position,a.zIndex=e.zIndex,c.isObject(h)&&c.isNode(d)&&(d.style[h.key]=h.value)}},25),this.dispatchEvent(X,plat.events.EventManager.DIRECT)}},b.prototype.open=function(){var a=this,b=!this._isOpen,c=this.utils;c.isFunction(this._toggleDelay)&&this._toggleDelay();var d=new this._Promise(function(b){a._toggleDelay=c.requestAnimationFrame(function(){a._touchState=0,a._toggleDelay=null,a._open().then(b)})});if(b){var e=this._drawer;this.inputChanged(!0),c.isNull(e)||e.inputChanged(!0)}return d},b.prototype.close=function(){var a=this,b=this._isOpen,c=this.utils;c.isFunction(this._toggleDelay)&&this._toggleDelay();var d=new this._Promise(function(b){a._toggleDelay=c.requestAnimationFrame(function(){a._touchState=0,a._toggleDelay=null,a._close().then(b)})});if(b){var e=this._drawer;this.inputChanged(!1),c.isNull(e)||e.inputChanged(!1)}return d},b.prototype.toggle=function(){return this._isOpen?this.close():this.open()},b.prototype.reset=function(){return this._isOpen?this.open():this.close()},b.prototype.isOpen=function(){return this._isOpen},b.prototype.bindTemplate=function(a,b){var c=this,d=this.bindableTemplates;return d.add(a,b),d.bind(a).then(function(a){var b=c._drawerElement;c.dom.clearNode(b),b.appendChild(a)}).catch(function(a){var b=c._Exception;b.warn("Error binding template for "+c.type+": "+a,b.BIND)})},b.prototype.observeProperties=function(a){a.observeProperty(this._setBoundProperty)},b.prototype._setBoundProperty=function(a,b,c,d){var e=this,f=this.utils;if(d===!0&&f.isNull(a))return void this.inputChanged(this._isOpen);if(f.isBoolean(a)){if(!this._isInitialized)return void(this._preInitializedValue=a);if(a){if(this._isOpen)return;return void(this._toggleDelay=f.requestAnimationFrame(function(){e._touchState=0,e._toggleDelay=null,e._open()}))}return void(this._isOpen&&(this._toggleDelay=f.requestAnimationFrame(function(){e._touchState=0,e._toggleDelay=null,e._close()})))}var g=this._Exception;g.warn("Attempting to bind "+this.type+" with a value that is something other than a boolean.",g.BIND)},b.prototype._open=function(){var a=this,b=this._rootElement,c=this._drawerElement,d=this.utils,e=d.isNode,f=!this._isOpen,g=this._getOffset();if(!(g&&e(b)&&e(c)))return this._Promise.resolve(null);var h;switch(this._position){case"left":h="translate3d("+g+"px,0,0)";break;case"right":h="translate3d("+-g+"px,0,0)";break;case"top":h="translate3d(0,"+g+"px,0)";break;case"bottom":h="translate3d(0,"+-g+"px,0)";break;default:return this._animator.resolve()}this._isOpen=!0,c.removeAttribute(C),f?(this.dom.addClass(b,o+"-open "+this._directionalTransitionPrep),this._addEventIntercepts()):this.dom.addClass(b,this._directionalTransitionPrep);var i={};return i[this._transform]=h,this._animationThenable=this._animator.animate(b,J,{properties:i}).then(function(){a._animationThenable=null})},b.prototype._close=function(){var a=this,b=this._rootElement,c=this._drawerElement,d=this.dom,e=this.utils,f=e.isNode;if(this._isOpen&&(this._removeEventIntercepts(),d.removeClass(b,o+"-open")),this._isOpen=!1,!f(b)||!f(c))return this._Promise.resolve(null);var g={},h=this._transform;return g[h]=this._preTransform,this._animationThenable=this._animator.animate(b,J,{properties:g}).then(function(){a._animationThenable=null,a._isOpen||(c.setAttribute(C,""),d.removeClass(b,a._directionalTransitionPrep))})},b.prototype._addEventIntercepts=function(){var a=this._clickEater,b=a.style,c=this._rootElement;if(b.top=c.scrollTop+"px",b.left=c.scrollLeft+"px",c.insertBefore(a,null),this._isTap&&this._addTapClose(),this._isSwipe&&this._addSwipeClose(),this._isTrack){var d=this.addEventListener(a,N,this._touchStart,!1),e=this.addEventListener(a,R,this._track,!1),f=this._touchEnd,g=this.addEventListener(a,S,f,!1),h=this.addEventListener(a,O,f,!1);this._openTrackRemover=function(){d(),e(),g(),h()}}},b.prototype._removeEventIntercepts=function(){this._rootElement.removeChild(this._clickEater);var a=this.utils.isFunction;this._isTap&&a(this._openTapRemover)&&(this._openTapRemover(),this._openTapRemover=null),this._isTrack&&a(this._openTrackRemover)&&(this._openTrackRemover(),this._openTrackRemover=null),this._isSwipe&&a(this._openSwipeRemover)&&(this._openSwipeRemover(),this._openSwipeRemover=null)},b.prototype._addSwipeOpen=function(){var a=this;this._removeSwipeOpen=this.addEventListener(this.element,Q+_[this._position],function(){a._hasSwiped=!0,a.open()},!1)},b.prototype._addSwipeClose=function(){var a=this;this._openSwipeRemover=this.addEventListener(this._clickEater,Q+this._position,function(){a._hasSwiped=!0,a.close()},!1)},b.prototype._addTapOpen=function(){var a=this;this._removeTap=this.addEventListener(this.element,M,function(){a._hasTapped=!0,a.open()},!1)},b.prototype._addTapClose=function(){var a=this;this._openTapRemover=this.addEventListener(this._clickEater,M,function(){a._hasTapped=!0,a.close()},!1)},b.prototype._addEventListeners=function(){var a=this.element,b=this.utils.isNull,c=this._type.split(" "),d=this._position;if((this._isTap=-1!==c.indexOf("tap"))&&this._addTapOpen(),(this._isSwipe=-1!==c.indexOf("swipe"))&&this._addSwipeOpen(),this._isTrack=-1!==c.indexOf("track")){var e,f=this._track;switch(d){case"left":case"right":e=d;break;case"top":e="up";break;case"bottom":e="down";break;default:return}if(this._removePrimaryTrack=this.addEventListener(a,R+_[e],f,!1),this._removeSecondaryTrack=this.addEventListener(a,R+e,f,!1),b(this._lastTouch)){var g=this._touchEnd;this._lastTouch={x:0,y:0},this.addEventListener(a,N,this._touchStart,!1),this.addEventListener(a,O,g,!1),this.addEventListener(a,S,g,!1)}}},b.prototype._removeEventListeners=function(){var a=this.utils.isFunction;this._isTap&&a(this._removeTap)&&(this._removeTap(),this._removeTap=null),this._isTrack&&(a(this._removePrimaryTrack)&&(this._removePrimaryTrack(),this._removePrimaryTrack=null),a(this._removeSecondaryTrack)&&(this._removeSecondaryTrack(),this._removeSecondaryTrack=null)),this._isSwipe&&a(this._removeSwipeOpen)&&(this._removeSwipeOpen(),this._removeSwipeOpen=null)},b.prototype._touchStart=function(a){1!==this._touchState&&(this.utils.isNull(this._animationThenable)||this._animationThenable.cancel(),this._initTouch(a))},b.prototype._initTouch=function(a){this._touchState=1,this._lastTouch={x:a.clientX,y:a.clientY},this._isOpen||(this._drawerElement.removeAttribute(C),this.dom.addClass(this._rootElement,this._directionalTransitionPrep))},b.prototype._touchEnd=function(a){var b=1!==this._touchState,c=this._hasSwiped,d=this._hasTapped;if(this._hasSwiped=this._hasTapped=!1,d||b||c)return void(this._touchState=0);this._touchState=2;var e=this._isVertical?a.clientY-this._lastTouch.y:a.clientX-this._lastTouch.x;if(this._isRightDirection(e)){var f=this._getOffset();if(!f)return;if(Math.abs(e)>Math.ceil(f/2))return void this.toggle();this.reset()}else this._isElastic?Math.abs(e)>0&&this.reset():this._isOpen||(this._drawerElement.setAttribute(C,""),this.dom.removeClass(this._rootElement,this._directionalTransitionPrep))},b.prototype._track=function(a){var b=this;0!==this._touchState&&this.utils.requestAnimationFrame(function(){b._rootElement.style[b._transform]=b._calculateTranslation(a)})},b.prototype._isRightDirection=function(a){switch(this._position){case"left":case"top":return this._isOpen?0>a:a>0;case"right":case"bottom":return this._isOpen?a>0:0>a;default:return!1}},b.prototype._calculateTranslation=function(a){var b,c=this._getOffset();if(!c)return"translate3d(0,0,0)";switch(this._position){case"left":return b=this._checkElasticity(c,a.clientX-this._lastTouch.x),"translate3d("+b+"px,0,0)";case"right":return b=this._checkElasticity(c,this._lastTouch.x-a.clientX),"translate3d("+-b+"px,0,0)";case"top":return b=this._checkElasticity(c,a.clientY-this._lastTouch.y),"translate3d(0,"+b+"px,0)";case"bottom":return b=this._checkElasticity(c,this._lastTouch.y-a.clientY),"translate3d(0,"+-b+"px,0)";default:return this._preTransform}},b.prototype._checkElasticity=function(a,b){var c=this._isOpen?a+b:b;return this._isElastic?c:(0>c?c=0:c>a&&(c=a),c)},b.prototype._initializeEvents=function(a,b){var c=this,d=this._useContext,e=this.on(W+"_"+a,function(f,g){e();var h=c.utils,i=h.isString,j=h.isUndefined,k=(c._drawer=g.control)||{};c._drawerElement=k.element;if(!i(b)){if(!i(g.position)){var l=c._Exception;return void l.warn('"position" is incorrectly defined for a control such as "'+o+'" or "'+c.type+'." Please ensure it is a string.',l.CONTROL)}b=g.position}if(c._controllerIsValid(b.toLowerCase()))return c._setTransform(),c._addEventListeners(),j(c._isElastic)&&(c._isElastic=g.elastic===!0),g.received||c.dispatchEvent(V+"_"+a,plat.events.EventManager.DIRECT,{control:c,received:!0,position:b,useContext:d}),d?void c._determineTemplate(g.template).then(function(){c._isInitialized=!0,c._checkPreInit()}):(c._isInitialized=!0,void c._checkPreInit())});this.dispatchEvent(V+"_"+a,plat.events.EventManager.DIRECT,{control:this,received:!1,position:b,useContext:d})},b.prototype._checkPreInit=function(){var a=this;this._preInitializedValue&&(this._toggleDelay=this.utils.postpone(function(){a._touchState=0,a._toggleDelay=null,a._open()}))},b.prototype._determineTemplate=function(a){var b=this,c=this.utils;return c.isString(this._templateUrl)?plat.ui.TemplateControl.determineTemplate(this,this._templateUrl).then(function(a){return b.bindTemplate("drawer",a)}):c.isNode(a)?this.bindTemplate("drawer",a):this._Promise.resolve()},b.prototype._setTransform=function(){var a=this._rootElement.style,b=this.utils.isUndefined,c=this._compat.vendorPrefix;b(this._preTransform=a[c.lowerCase+"Transform"])?b(this._preTransform=a[c.upperCase+"Transform"])?this._transform="transform":this._transform=c.upperCase+"Transform":this._transform=c.lowerCase+"Transform"},b.prototype._controllerIsValid=function(a){var b,c=this,d=this.utils.isNull;if(d(this._drawerElement))return b=this._Exception,b.warn('Could not find a corresponding control such as "'+o+'" for this "'+this.type+'."',b.CONTROL),!1;switch(a){case"top":case"bottom":this._isVertical=!0;case"left":case"right":this._position=a;break;default:return b=this._Exception,b.warn('Incorrect position: "'+a+'" defined for the a control such as "'+o+'", or "'+this.type+'."',b.CONTROL),!1}var e=this._rootElement=this._getRootElement();return d(e)?(b=this._Exception,b.warn('Cannot have a "'+this.type+'" in a hierarchy above the corresponding control such as "'+o+'."',b.CONTROL),!1):(this._clickEater=this._document.createElement("div"),this._clickEater.className="plat-clickeater",this.dom.addClass(e,"plat-drawer-transition-prep"),this._directionalTransitionPrep="plat-drawer-transition-"+a,this._disposeRemover=this.on(X,function(){c.dispatchEvent(Y,plat.events.EventManager.DIRECT,e)}),!0)},b.prototype._getRootElement=function(){var a=this._drawer,b=this.utils;if(!b.isNull(a.storedProperties))return a.storedProperties.rootElement;for(var c,d=b.isNode,e=this.root,f=b.isObject(e)&&d(e.element)?e.element:this.element,g=this._drawerElement;d(c=f.parentElement)&&!c.contains(g);)f=c;var h=this._window,i=h.getComputedStyle(f),j=f.style,k=i.position,l=Number(i.zIndex),m={rootElement:f};if("static"===k&&(m.position=j.position,j.position="relative"),(!b.isNumber(l)||1>l)&&(m.zIndex=j.zIndex,j.zIndex="1"),d(c)){var n=c.style,o=n.overflow;if("hidden"!==o){var p,q,r=h.getComputedStyle(c);r.overflow;this._isVertical?(q="overflowY",p=r.overflowY):(q="overflowX",p=r.overflowX),"hidden"!==p&&(m.parentOverflow={key:q,value:n[q]},n[q]="hidden")}}return a.storedProperties=m,f},b.prototype._getOffset=function(){var a=this._drawerElement;a.hasAttribute(C);if(a.hasAttribute(C)){a.removeAttribute(C);var b=this._isVertical?a.offsetHeight:a.offsetWidth;return a.setAttribute(C,""),b}return this._isVertical?a.offsetHeight:a.offsetWidth},b._inject={_document:g,_window:f,_compat:d,_animator:h,_Promise:c},b}(plat.ui.BindControl);a.DrawerController=ia,plat.register.control(p,ia);var ja=function(a){function b(){a.apply(this,arguments),this.templateString='<div class="plat-modal-container"></div>\n',this._isVisible=!1,this._scrollRemover=aa,this._scrollTop=0,this._transitionHash={up:!0,down:!0,left:!0,right:!0,fade:!0}}return __extends(b,a),b.prototype.setClasses=function(a,b){this.dom.addClass(b||this.element,q+" "+C+" "+(a||""))},b.prototype.initialize=function(){var a=this.options||(this.options={}),b=a.value||(a.value={});this.templateUrl=b.templateUrl,this.setClasses()},b.prototype.setTemplate=function(){var a,b=this.utils;if(b.isString(this.templateUrl)){var c=this.dom,d=c.serializeHtml(this.templateString),e=this.element;a=this._container=d.firstChild,this.innerTemplate=c.appendChildren(e.childNodes),e.appendChild(d)}},b.prototype.loaded=function(){var a,b=this.options.value,c=b.transition;if(this._container=this._container||this.element.firstElementChild,this._injectElement(),!this.utils.isString(c)||"none"===c)return void this.dom.addClass(this._container,l+"no-transition");this._transitionHash[c]||(a=this._Exception,a.warn('Custom transition: "'+c+'" defined for "'+this.type+'." Please ensure the transition is defined to avoid errors.',a.CONTROL));var d=this._compat.animationEvents;return this.utils.isNull(d)?(a=this._Exception,a.warn("This browser does not support CSS3 animations.",a.COMPAT),void this.dom.addClass(this._container,l+"no-transition")):(this._transitionEnd=d.$transitionEnd,void this.dom.addClass(this._container,l+c+" "+l+"modal-transition"))},b.prototype.dispose=function(){a.prototype.dispose.call(this),this._scrollRemover()},b.prototype.show=function(){var a=!this._isVisible,b=this._show();return a&&this.inputChanged(!0),b},b.prototype.hide=function(){var a=this.isVisible,b=this._hide();return a&&this.inputChanged(!1),b},b.prototype.toggle=function(){return this._isVisible?this.hide():this.show()},b.prototype.isVisible=function(){return this._isVisible},b.prototype.observeProperties=function(a){a.observeProperty(this._setBoundProperty)},b.prototype._setBoundProperty=function(a,b,c,d){var e=this.utils;if(d===!0&&e.isNull(a))return void this.inputChanged(this._isVisible);if(e.isBoolean(a)){if(a){if(this._isVisible)return;return void this._show()}return void(this._isVisible&&this._hide())}var f=this._Exception;f.warn("Attempting to show or hide a "+this.type+" with a bound value that is something other than a boolean.",f.BIND)},b.prototype._show=function(){var a=this,b=this.dom,c=this.utils;return c.isNull(this.innerTemplate)?(this._isVisible=!0,new this._Promise(function(d){c.requestAnimationFrame(function(){a._alignModal(),b.removeClass(a.element,C),c.defer(function(){c.requestAnimationFrame(function(){b.addClass(a._container,l+"activate"),d()})},20)})})):this._bindInnerTemplate()},b.prototype._alignModal=function(a){var b=this,c=this.utils,d=c.isNull,e=this._document,f=e.documentElement,g=d(f)||!f.scrollTop?e.body:f,h=g.scrollTop;this._scrollTop!==h&&(d(a)?(this.element.style.top=h+"px",this._scrollRemover=this.addEventListener(this._window,"scroll",this._alignModal,!1)):c.requestAnimationFrame(function(){b.element.style.top=h+"px"}),this._scrollTop=h)},b.prototype._hide=function(){var a,b=this,c=this.dom,d=this.utils;return this._scrollRemover(),this._scrollRemover=aa,this._isVisible=!1,d.isString(this._transitionEnd)?(a=this._addHideOnTransitionEnd(),d.requestAnimationFrame(function(){c.removeClass(b._container,l+"activate")})):a=new this._Promise(function(a){d.requestAnimationFrame(function(){c.addClass(b.element,C),c.removeClass(b._container,l+"activate"),a()})}),a},b.prototype._bindInnerTemplate=function(){var a=this,b=this.innerTemplate,c=this.bindableTemplates,d="modal";return c.add(d,b),this.innerTemplate=null,c.bind(d).then(function(b){return a._container.insertBefore(b,null),a._show()})},b.prototype._injectElement=function(){var a=this.element,b=a.parentElement,c=this._document.body;this.utils.isNode(b)&&b!==c&&c.insertBefore(a,null)},b.prototype._addHideOnTransitionEnd=function(){var a=this;return new this._Promise(function(b){var c=a.element,d=a.addEventListener(c,a._transitionEnd,function(){d(),a.dom.addClass(c,C),b()},!1)})},b._inject={_window:f,_document:g,_compat:d,_Promise:c},b}(plat.ui.BindControl);a.Modal=ja,plat.register.control(q,ja);var ka=function(a){function b(){a.apply(this,arguments),this.templateString='<div class="plat-slider-container">\n    <div class="plat-slider-track">\n        <div class="plat-knob"></div>\n    </div>\n</div>\n',this._isVertical=!1,this._knobOffset=0,this._touchState=0,this._cloneAttempts=0,this._maxCloneAttempts=25}return __extends(b,a),b.prototype.setClasses=function(a,b){this.dom.addClass(b||this.element,v+" "+(a||""))},b.prototype.initialize=function(){this.setClasses()},b.prototype.loaded=function(){var a=this.element,b=this._slider=a.firstElementChild.firstElementChild,c=this.utils.isNumber,d=this.options||{},e=d.value||{},f=Number(e.value),g=e.min,h=e.max,i=e.step,j=this._reversed=e.reverse===!0,k=this.min=c(g)?Math.floor(g):0,m=this.max=c(h)?Math.ceil(h):100,n=c(f)?Math.round(f):k,o=l+this._validateOrientation(e.orientation);if(this._knob=b.firstElementChild,j&&(o+=Z),this.dom.addClass(a,o),this.value=k,this._step=c(i)&&i>0?Math.round(i):1,k>=m){var p=this._Exception;p.warn('"'+this.type+"'s\" min is greater than or equal to its max. Setting max to min + 1.",p.CONTROL),this.max=k+1}this._setLength(),this._initializeEvents(),this.setValue(n)},b.prototype.setValue=function(a){this._setValue(a,!0)},b.prototype.observeProperties=function(a){
a.observeProperty(this._setBoundProperty)},b.prototype._setBoundProperty=function(a,b,c,d){return d===!0&&this.utils.isNull(a)?void this.inputChanged(this.value):void this._setValue(a,!1)},b.prototype._setValue=function(a,b){var c=this.utils;if(1===this._touchState){var d=this._Exception;return void d.warn("Cannot set the value of "+this.type+" while the user is manipulating it.",d.CONTROL)}if(c.isNull(a))a=this.min;else if(!c.isNumber(a))return;this._setValueProperty(a,!0,b)},b.prototype._initializeEvents=function(){var a,b,c=this,d=this.element,e=this._track,f=this._touchEnd;this._isVertical?(a=R+"down",b=R+"up"):(a=R+"right",b=R+"left"),this.addEventListener(d,N,this._touchStart,!1),this.addEventListener(d,a,e,!1),this.addEventListener(d,b,e,!1),this.addEventListener(d,O,f,!1),this.addEventListener(d,S,f,!1),this.addEventListener(this._window,"resize",function(){c._setLength(),c._setKnob()},!1)},b.prototype._touchStart=function(a){var b=this;if(1!==this._touchState){this._touchState=1,this._lastTouch={x:a.clientX,y:a.clientY,value:this.value};var c=a.target;if(c!==this._knob){var d;d=this._isVertical?c===this.element?this._reversed?a.offsetY-this._sliderOffset:this._maxOffset-(a.offsetY-this._sliderOffset):c===this._slider?this._reversed?a.offsetY:this._knobOffset-a.offsetY:this._reversed?a.offsetY:this._maxOffset-a.offsetY:c===this.element?this._reversed?this._maxOffset-(a.offsetX-this._sliderOffset):a.offsetX-this._sliderOffset:c===this._slider?this._reversed?this._knobOffset-a.offsetX:a.offsetX:this._reversed?this._maxOffset-a.offsetX:a.offsetX,this.utils.requestAnimationFrame(function(){b._knobOffset=b._setSliderProperties(d)})}}},b.prototype._touchEnd=function(a){var b=this;if(1!==this._touchState)return void(this._touchState=0);this._touchState=2;var c=this._calculateOffset(a),d=this._maxOffset;this.utils.requestAnimationFrame(function(){return b._touchState=0,b._lastTouch.value!==b.value&&b._trigger("change"),0>c?void(b._knobOffset=0):c>d?void(b._knobOffset=d):void(b._knobOffset=c)})},b.prototype._track=function(a){var b=this;0!==this._touchState&&this.utils.requestAnimationFrame(function(){b._setSliderProperties(b._calculateOffset(a))})},b.prototype._setSliderProperties=function(a){var b,c=this._maxOffset;if(0>=a){if(b=this.min,b-this.value>=0)return;a=0}else if(a>=c){if(b=this.max,b-this.value<=0)return;a=c}else b=this._calculateValue(a);return this._setValueProperty(b,!1,!0),this._slider.style[this._lengthProperty]=a+"px",a},b.prototype._calculateValue=function(a){var b=this._step;return this.min+Math.round(a/this._increment/b)*b},b.prototype._calculateKnobPosition=function(a){return(a-this.min)*this._increment},b.prototype._calculateOffset=function(a){return this._isVertical?this._reversed?this._knobOffset+a.clientY-this._lastTouch.y:this._knobOffset+this._lastTouch.y-a.clientY:this._reversed?this._knobOffset+this._lastTouch.x-a.clientX:this._knobOffset+a.clientX-this._lastTouch.x},b.prototype._setLength=function(a){var b=this.utils.isNode(a),c=b?a:this._slider.parentElement;return this._isVertical?(this._lengthProperty="height",this._maxOffset=c.offsetHeight,this._sliderOffset=c.offsetTop):(this._lengthProperty="width",this._maxOffset=c.offsetWidth,this._sliderOffset=c.offsetLeft),b||this._maxOffset?void this._setIncrement():void this._setOffsetWithClone(this._lengthProperty)},b.prototype._setIncrement=function(){return this._increment=this._maxOffset/(this.max-this.min)},b.prototype._setValueProperty=function(a,b,c){var d=this.value;if(a!==d){if(a>=this.max)a=this.max;else if(a<=this.min)a=this.min;else if(Math.abs(a-d)<this._step)return;this.value=this.element.value=a,b&&this._setKnob(),c&&this.inputChanged(a,d),this._trigger("input")}},b.prototype._setKnob=function(a){var b={},c=this._calculateKnobPosition(a||this.value);c!==this._knobOffset&&(b[this._lengthProperty]=c+"px",this._animator.animate(this._slider,J,{properties:b}),this._knobOffset=c)},b.prototype._trigger=function(a){var b=plat.acquire(i);b.initialize(this.element,a),b.trigger()},b.prototype._validateOrientation=function(a){if(this.utils.isUndefined(a))return"horizontal";var b;if("horizontal"===a)b=a;else if("vertical"===a)b=a,this._isVertical=!0;else{var c=this._Exception;c.warn('Invalid orientation "'+a+'" for '+this.type+'. Defaulting to "horizontal."',c.CONTROL),b="horizontal"}return b},b.prototype._setOffsetWithClone=function(a){var b,c=this.element,d=this._document.body;if(!d.contains(c)){var e=++this._cloneAttempts;if(e===this._maxCloneAttempts){var f=this.type;return b=this._Exception,b.warn("Max clone attempts reached before the "+f+" was placed into the DOM. Disposing of the "+f+".",b.CONTROL),void plat.acquire(j).dispose(this)}return void this.utils.defer(this._setOffsetWithClone,20,[a],this)}var g=this._cloneAttempts>0;this._cloneAttempts=0;var h,i,k=c.cloneNode(!0),l=/\d+(?!\d+|%)/,m=this._window,n=[],o=k,p="important",q=this.utils.isNull;for(o.id="";!l.test(i=(h=m.getComputedStyle(c))[a]);){if("none"===h.display&&o.style.setProperty("display","block",p),o.style.setProperty(a,i,p),c=c.parentElement,q(c))return b=this._Exception,b.warn("The document's body contains a "+this.type+" that needs its length and is currently hidden. Please do not set the body's display to none.",b.CONTROL),void this.utils.defer(this._setOffsetWithClone,100,[a],this);o=c.cloneNode(!1),o.id="",n.push(o)}if(n.length>0){var r,s=n.pop();for(s.style;n.length>0;)r=n.pop(),s.insertBefore(r,null),s=r;s.insertBefore(k,null)}var t=o.style;t.setProperty(a,i,p),t.setProperty("visibility","hidden",p),d.appendChild(o),this._setLength(k.firstElementChild),d.removeChild(o),g&&this._setKnob()},b._inject={_document:g,_window:f,_animator:h},b}(plat.ui.BindControl);a.Slider=ka,plat.register.control(v,ka);var la=function(a){function b(){a.apply(this,arguments),this.templateString='<div class="plat-range-container">\n    <div class="plat-range-track">\n        <div class="plat-lower-knob"></div>\n        <div class="plat-upper-knob"></div>\n    </div>\n</div>\n',this._isVertical=!1,this._touchState=0,this._cloneAttempts=0,this._maxCloneAttempts=25}return __extends(b,a),b.prototype.setClasses=function(a,b){this.dom.addClass(b||this.element,w+" "+(a||""))},b.prototype.initialize=function(){this.setClasses()},b.prototype.loaded=function(){var a,b=this.element,c=this._slider=b.firstElementChild.firstElementChild,d=this.utils,e=d.isNumber,f=this.options||{},g=f.value||{},h=Number(g.lower),i=Number(g.upper),j=g.identifiers||{},k=g.min,m=g.max,n=g.step,o=this._reversed=g.reverse===!0,p=this.min=e(k)?Math.floor(k):0,q=this.max=e(m)?Math.ceil(m):100,r=e(h)?Math.round(h):p,s=e(i)?Math.round(i):q,t=l+this._validateOrientation(g.orientation);if(this._lowerKnob=c.firstElementChild,this._upperKnob=c.lastElementChild,this._lowerIdentifier=j.lower||"lower",this._upperIdentifier=j.upper||"upper",o){var u=this._lowerKnob;this._lowerKnob=this._upperKnob,this._upperKnob=u,t+=Z}this.dom.addClass(b,t),this.lower=p,this.upper=q,this._step=e(n)&&n>0?Math.round(n):1,p>=q&&(a=this._Exception,a.warn('"'+this.type+"'s\" min is greater than or equal to its max. Setting max to min + 1.",a.CONTROL),this.max=p+1),this._setPositionAndLength(),this._setLowerKnobPosition(p),this._initializeEvents(),this.setLower(r),this.setUpper(s)},b.prototype.setLower=function(a){this._setLower(a,!0)},b.prototype.setUpper=function(a){this._setUpper(a,!0)},b.prototype.observeProperties=function(a){a.observeProperty(this._setLowerBoundProperty,this._lowerIdentifier),a.observeProperty(this._setUpperBoundProperty,this._upperIdentifier)},b.prototype._setLowerBoundProperty=function(a,b,c,d){d===!0&&this.utils.isNull(a)&&this._fireChange(),this._setLower(a,!1)},b.prototype._setUpperBoundProperty=function(a,b,c,d){d===!0&&this.utils.isNull(a)&&this._fireChange(),this._setUpper(a,!1)},b.prototype._setLower=function(a,b){var c=this.utils;if(2===this._touchState){var d=this._Exception;return void d.warn("Cannot set the value of the "+this.type+"'s lower knob while the user is manipulating it.",d.CONTROL)}if(c.isNull(a)&&(a=this.min),!c.isNumber(a)){var e=Number(a);if(!c.isNumber(e))return;a=e}this._setLowerValue(a,!0,b,!0)},b.prototype._setUpper=function(a,b){var c=this.utils;if(3===this._touchState){var d=this._Exception;return void d.warn("Cannot set the upper value of the "+this.type+"'s upper knob while the user is manipulating it.",d.CONTROL)}if(c.isNull(a)&&(a=this.max),!c.isNumber(a)){var e=Number(a);if(!c.isNumber(e))return;a=e}this._setUpperValue(a,!0,b,!0)},b.prototype._initializeEvents=function(){var a,b,c=this,d=this._lowerKnob,e=this._upperKnob,f=this._touchStart,g=this._touchEnd,h=this._trackLower,i=this._trackUpper;this._isVertical?(a=R+"down",b=R+"up"):(a=R+"right",b=R+"left"),this.addEventListener(d,N,f,!1),this.addEventListener(e,N,f,!1),this.addEventListener(d,a,h,!1),this.addEventListener(d,b,h,!1),this.addEventListener(e,a,i,!1),this.addEventListener(e,b,i,!1),this.addEventListener(d,O,g,!1),this.addEventListener(e,O,g,!1),this.addEventListener(d,S,g,!1),this.addEventListener(e,S,g,!1),this.addEventListener(this._window,"resize",function(){c._setPositionAndLength(),c._setLowerKnobPosition(),c._setUpperKnobPosition()},!1)},b.prototype._touchStart=function(a){var b=this._touchState;if(1!==b&&2!==b&&3!==b){this._touchState=1;var c=a.currentTarget,d=this._lastTouch;this.utils.isNull(d)?c.style.zIndex="1":d.target!==c&&(d.target.style.zIndex="0",c.style.zIndex="1"),this._lastTouch={x:a.clientX,y:a.clientY,value:c===this._lowerKnob?this.lower:this.upper,target:c}}},b.prototype._touchEnd=function(a){var b=this,c=this._touchState;if(0===c||4===c)return void(this._touchState=0);this._touchState=4;var d=this._lastTouch,e=a.currentTarget;this.utils.isNull(d)||d.target!==e||this.utils.requestAnimationFrame(function(){b._touchState=0;var c=e===b._lowerKnob,f=b._calculateOffset(a,c);c?d.value!==b.lower&&b._trigger("change"):d.value!==b.upper&&b._trigger("change"),b._setOffset(f,c)})},b.prototype._setOffset=function(a,b){var c=this._maxOffset;return 0>a?b?this._lowerKnobOffset=0:this._upperKnobOffset=0:a>c?b?this._lowerKnobOffset=c:this._upperKnobOffset=c:b?this._lowerKnobOffset=a:this._upperKnobOffset=a},b.prototype._trackLower=function(a){var b=this._touchState;if(2!==b)if(1===b)this._touchState=2;else if(0===b||3===b)return;var c,d=this._maxOffset,e=this._calculateOffset(a,!0);return 0>=e?(c=this.min,c-this.lower>=0&&(c=null),e=0):e>=d?(c=this.max,c-this.lower<=0&&(c=null),e=d):(c=this._calculateValue(e),c-this.lower===0&&(c=null)),e>this._upperKnobOffset?(this._positionTogether(e,c),void this._setOffset(e,!1)):void this._positionLower(e,c)},b.prototype._trackUpper=function(a){var b=this._touchState;if(3!==b)if(1===b)this._touchState=3;else if(0===b||2===b)return;var c,d=this._maxOffset,e=this._calculateOffset(a,!1);return 0>=e?(c=this.min,c-this.upper>=0&&(c=null),e=0):e>=d?(c=this.max,c-this.upper<=0&&(c=null),e=d):(c=this._calculateValue(e),c-this.upper===0&&(c=null)),e<this._lowerKnobOffset?(this._positionTogether(e,c),void this._setOffset(e,!0)):void this._positionUpper(e,c)},b.prototype._positionLower=function(a,b){var c=this;this.utils.requestAnimationFrame(function(){var d=c._slider.style;d[c._positionProperty]=a+"px",d[c._lengthProperty]=c._upperKnobOffset-a+"px",null!==b&&c._setLowerValue(b,!1,!0,!0)})},b.prototype._positionUpper=function(a,b){var c=this;this.utils.requestAnimationFrame(function(){c._slider.style[c._lengthProperty]=a-c._lowerKnobOffset+"px",null!==b&&c._setUpperValue(b,!1,!0,!0)})},b.prototype._positionTogether=function(a,b){var c=this;this.utils.requestAnimationFrame(function(){var d=c._slider.style;d[c._positionProperty]=a+"px",d[c._lengthProperty]="0px",null!==b&&(c._setLowerValue(b,!1,!1,!1),c._setUpperValue(b,!1,!0,!0))})},b.prototype._calculateValue=function(a){var b=this._step;return this.min+Math.round(a/this._increment/b)*b},b.prototype._calculateOffset=function(a,b){var c,d=b?this._lowerKnobOffset:this._upperKnobOffset;return c=this._isVertical?this._reversed?a.clientY-this._lastTouch.y:this._lastTouch.y-a.clientY:this._reversed?this._lastTouch.x-a.clientX:a.clientX-this._lastTouch.x,d+c},b.prototype._calculateKnobPosition=function(a){return(a-this.min)*this._increment},b.prototype._setLowerValue=function(a,b,c,d){var e=this.lower;if(a!==e){if(a>=this.max)a=this.max;else if(a<=this.min)a=this.min;else if(Math.abs(a-e)<this._step)return;this.lower=a,b&&this._setLowerKnobPosition(),c&&this._fireChange(),d&&this._trigger("input")}},b.prototype._setUpperValue=function(a,b,c,d){var e=this.upper;if(a!==e){if(a>=this.max)a=this.max;else if(a<=this.min)a=this.min;else if(Math.abs(a-e)<this._step)return;this.upper=a,b&&this._setUpperKnobPosition(),c&&this._fireChange(),d&&this._trigger("input")}},b.prototype._setIncrement=function(){return this._increment=this._maxOffset/(this.max-this.min)},b.prototype._setPositionAndLength=function(a){var b=this.utils.isNode(a),c=b?a:this._slider.parentElement;return this._isVertical?(this._lengthProperty="height",this._positionProperty=this._reversed?"top":"bottom",this._maxOffset=c.offsetHeight):(this._lengthProperty="width",this._positionProperty=this._reversed?"right":"left",this._maxOffset=c.offsetWidth),b||this._maxOffset?void this._setIncrement():void this._setOffsetWithClone(this._lengthProperty)},b.prototype._setLowerKnobPosition=function(a){var b={},c=this._upperKnobOffset,d=this.utils.isNumber(c)?c:this._setOffset(this._calculateKnobPosition(this.upper),!1),e=this._calculateKnobPosition(a||this.lower);e!==this._lowerKnobOffset&&(b[this._positionProperty]=e+"px",b[this._lengthProperty]=d-e+"px",this._animator.animate(this._slider,J,{properties:b}),this._lowerKnobOffset=e)},b.prototype._setUpperKnobPosition=function(a){var b={},c=this._calculateKnobPosition(a||this.upper);c!==this._upperKnobOffset&&(b[this._lengthProperty]=c-this._lowerKnobOffset+"px",this._animator.animate(this._slider,J,{properties:b}),this._upperKnobOffset=c)},b.prototype._fireChange=function(){var a={};a[this._lowerIdentifier]=this.lower,a[this._upperIdentifier]=this.upper,this.inputChanged(a)},b.prototype._trigger=function(a){var b=plat.acquire(i);b.initialize(this.element,a),b.trigger()},b.prototype._validateOrientation=function(a){if(this.utils.isUndefined(a))return"horizontal";var b;if("horizontal"===a)b=a;else if("vertical"===a)b=a,this._isVertical=!0;else{var c=this._Exception;c.warn('Invalid orientation "'+a+'" for '+this.type+'. Defaulting to "horizontal."',c.CONTROL),b="horizontal"}return b},b.prototype._setOffsetWithClone=function(a){var b,c=this.element,d=this._document.body;if(!d.contains(c)){var e=++this._cloneAttempts;if(e===this._maxCloneAttempts){var f=this.type;return b=this._Exception,b.warn("Max clone attempts reached before the "+f+" was placed into the DOM. Disposing of the "+f+".",b.CONTROL),void plat.acquire(j).dispose(this)}return void this.utils.defer(this._setOffsetWithClone,20,[a],this)}var g=this._cloneAttempts>0;this._cloneAttempts=0;var h,i,k=c.cloneNode(!0),l=/\d+(?!\d+|%)/,m=this._window,n=[],o=k,p="important",q=this.utils.isNull;for(o.id="";!l.test(i=(h=m.getComputedStyle(c))[a]);){if("none"===h.display&&o.style.setProperty("display","block",p),o.style.setProperty(a,i,p),c=c.parentElement,q(c))return b=this._Exception,b.warn("The document's body contains a "+this.type+" that needs its length and is currently hidden. Please do not set the body's display to none.",b.CONTROL),void this.utils.defer(this._setOffsetWithClone,100,[a],this);o=c.cloneNode(!1),o.id="",n.push(o)}if(n.length>0){var r,s=n.pop();for(s.style;n.length>0;)r=n.pop(),s.insertBefore(r,null),s=r;s.insertBefore(k,null)}var t=o.style;t.setProperty(a,i,p),t.setProperty("visibility","hidden",p),d.appendChild(o),this._setPositionAndLength(k.firstElementChild),d.removeChild(o),g&&(this._setLowerKnobPosition(),this._setUpperKnobPosition())},b._inject={_document:g,_window:f,_animator:h},b}(plat.ui.BindControl);a.Range=la,plat.register.control(w,la);var ma=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.setClasses=function(a,b){this.dom.addClass(b||this.element,x+" "+(a||""))},b.prototype.initialize=function(){a.prototype.initialize.call(this),this.setClasses()},b}(plat.ui.controls.Select);a.Select=ma,plat.register.control(x,ma);var na=function(a){function b(){a.apply(this,arguments),this.templateString='<div class="plat-input-container">\n    <span class="plat-input-image"></span>\n    <input type="text" />\n    <span class="plat-input-action">\n        <span class="plat-action"></span>\n    </span>\n</div>\n',this._inTouch=!1,this._inAction=!1}return __extends(b,a),b.prototype.setClasses=function(a,b){this.dom.addClass(b||this.element,y+" "+(a||""))},b.prototype.initialize=function(){this.setClasses()},b.prototype.setTemplate=function(){for(var a,b,c,d=this.element,e=this._imageElement=d.firstElementChild.firstElementChild,f=this._inputElement=e.nextElementSibling,g=this.attributes,h=Object.keys(g),i=h.length,j=plat.dependency.injectors.control,k=!1,l=/plat-(?:control|hide|context)|class|style/,m=this.utils,n=m.isNull,o=m.delimit,p=m.isString,q=0;i>q;++q)a=h[q],b=o(a,"-"),c=g[a],p(c)&&!l.test(b)&&n(j[b])&&("placeholder"===b?(k=!0,f.placeholder=c):f.setAttribute(b,c));if(!k&&!n(this.innerTemplate)){var r=this.innerTemplate.textContent.replace(/\r|\n/g,"");m.isEmpty(r)||(f.placeholder=r)}},b.prototype.loaded=function(){var a=this,b=this.options||{},c=b.value||{},d=this.element,e=this._type=this.attributes.type||c.type||"text",f=c.pattern;this._imageElement=this._imageElement||d.firstElementChild.firstElementChild,this._inputElement=this._inputElement||this._imageElement.nextElementSibling,this.dom.addClass(d,l+e);var g=this._inputElement.nextElementSibling;this.addEventListener(g,M,function(){a._inputElement.focus()},!1),this._actionElement=g.firstElementChild,this.utils.isEmpty(f)||("/"===f[0]&&"/"===f[f.length-1]&&(f=f.slice(1,-1)),this._pattern=new RegExp(f)),this._initializeType()},b.prototype.validate=function(){return this._pattern.test(this._inputElement.value)},b.prototype.clear=function(){var a=this._inputElement,b=a.value;if(""!==b){var c=this._actionElement;this.inputChanged(a.value="",b),c.textContent=this._typeChar="",c.setAttribute(C,"")}},b.prototype.focus=function(){this._inputElement.focus()},b.prototype.blur=function(){this._inputElement.blur()},b.prototype.value=function(){return this._inputElement.value},b.prototype.observeProperties=function(a){a.observeProperty(this._setBoundProperty)},b.prototype._setBoundProperty=function(a,b,c,d){var e=this._inputElement.value;if(this.utils.isNull(a)){if(a="",d===!0)return void(this.utils.isNull(e)&&this._onInputChanged(a))}else if(a===e)return;this._onInputChanged(a)},b.prototype._initializeType=function(){var a,b=this._type,c=M,d=this._actionElement;switch(b){case"text":this._pattern=this._pattern||/[\S\s]*/,this._actionHandler=this._checkText.bind(this),this._typeHandler=this._erase;break;case"email":this._pattern=this._pattern||this._regex.validateEmail,this._actionHandler=this._checkEmail.bind(this),this._typeHandler=this._handleEmail;break;case"password":var e=this._handlePasswordHide;this._pattern=this._pattern||/[\S\s]*/,this._actionHandler=this._checkPassword.bind(this),this._typeHandler=this._handlePasswordShow,this.addEventListener(d,O,e),this.addEventListener(d,S,e),c=N;break;case"tel":case"telephone":this._pattern=this._pattern||this._regex.validateTelephone,this._actionHandler=this._checkText.bind(this),this._typeHandler=this._erase;break;case"number":this._pattern=this._pattern||/^[0-9\.,]*$/,this._actionHandler=this._checkText.bind(this),this._typeHandler=this._erase,b="tel";break;case"hidden":return void this.element.setAttribute(C,"");case"radio":return a=this._Exception,void a.warn(b+" is not supported by "+this.type+". Please use a "+t+" instead.",a.CONTROL);case"checkbox":return a=this._Exception,void a.warn(b+" is not supported by "+this.type+". Please use a "+n+" instead.",a.CONTROL);case"range":return a=this._Exception,void a.warn(b+" is not supported by "+this.type+". Please use a "+v+" instead.",a.CONTROL);case"file":return a=this._Exception,void a.warn(b+" is not supported by "+this.type+". Please use a "+z+" instead.",a.CONTROL);default:a=this._Exception,a.warn(b+" is not yet fully supported by "+this.type+'. Defaulting to type="text".',a.CONTROL),b="text",this._pattern=this._pattern||/[\S\s]*/,this._actionHandler=this._checkText.bind(this),this._typeHandler=this._erase}this._inputElement.type=b,d.textContent=this._typeChar="",d.setAttribute(C,""),this._addEventListeners(c)},b.prototype._addEventListeners=function(a){var b=this,c=this._actionElement,d=this._inputElement,e=function(){return b._inAction=!1};this.addEventListener(c,a,this._typeHandler,!1),this.addEventListener(c,N,function(){return b._inAction=!0},!1),this.addEventListener(c,O,e,!1),this.addEventListener(c,S,e,!1),this.addEventListener(d,"focus",function(){""!==d.value&&c.removeAttribute(C)},!1),this.addEventListener(d,"blur",function(a){b._inAction||c.setAttribute(C,"")},!1),this._addTextEventListener()},b.prototype._addTextEventListener=function(){var a,b=this,c=this._inputElement,d=this._compat,e=this.utils,f=!1,g=function(){f||b._onInput()},h=function(){e.isFunction(a)||(a=e.postpone(function(){g(),a=null}))};e.isUndefined(d.ANDROID)&&(this.addEventListener(c,"compositionstart",function(){return f=!0},!1),this.addEventListener(c,"compositionend",function(){f=!1,g()},!1)),d.hasEvent("input")?this.addEventListener(c,"input",g,!1):(this.addEventListener(c,"keydown",function(a){var b=a.keyCode;91===b||92===b||b>15&&28>b||b>32&&41>b||h()},!1),this.addEventListener(c,"cut",h,!1),this.addEventListener(c,"paste",h,!1)),this.addEventListener(c,"change",g,!1)},b.prototype._erase=function(){this.clear(),this.focus()},b.prototype._handlePasswordShow=function(){this._inTouch=!0,this._inputElement.type="text"},b.prototype._handlePasswordHide=function(){if(this._inTouch){this._inTouch=!1;var a=this._inputElement;a.type=this._type,a.focus()}},b.prototype._handleEmail=function(){var a=this._inputElement,b=a.value,c=this._typeChar;this.inputChanged(a.value="x"===c?"":b+c,b),this._checkEmail(),a.focus()},b.prototype._checkText=function(){var a=this._typeChar;"x"===a?""===this._inputElement.value&&(this._typeChar=""):""!==this._inputElement.value&&(this._typeChar="x");var b=this._typeChar;if(a!==b){var c=this._actionElement;if(c.textContent=b,""===b)return void c.setAttribute(C,"");c.removeAttribute(C)}},b.prototype._checkPassword=function(){var a=this._typeChar;"?"===a?""===this._inputElement.value&&(this._typeChar=""):""!==this._inputElement.value&&(this._typeChar="?");var b=this._typeChar;if(a!==b){var c=this._actionElement;if(c.textContent=b,""===b)return void c.setAttribute(C,"");c.removeAttribute(C)}},b.prototype._checkEmail=function(){var a=this._inputElement.value,b=this._typeChar;switch(b){case"@":if(-1!==a.indexOf("@")){if(-1!==a.indexOf(".com")){this._typeChar="x";break}this._typeChar=".com"}break;case".com":-1===a.indexOf("@")?this._typeChar="@":-1!==a.indexOf(".com")&&(this._typeChar="x");break;case"x":""===a?this._typeChar="":-1===a.indexOf("@")?this._typeChar="@":-1===a.indexOf(".com")&&(this._typeChar=".com");break;default:""===a?this._typeChar="":-1===a.indexOf("@")&&(this._typeChar="@")}var c=this._typeChar;if(b!==c){var d=this._actionElement;if(d.textContent=c,""===c)return void d.setAttribute(C,"");d.removeAttribute(C)}},b.prototype._onInput=function(){var a=this._inputElement,b=a.value;switch(this._type){case"tel":case"number":var c=b.length-1;c>=0&&(!this._pattern.test(b[c])||0!==c&&"tel"===this._type&&"+"===b[c])&&(b=a.value=b.slice(0,-1));default:this.inputChanged(b)}this._actionHandler()},b.prototype._onInputChanged=function(a){var b=this._inputElement;switch(this._type){case"tel":case"number":var c=a.length-1;if(c>=0&&(!this._pattern.test(a[c])||0!==c&&"tel"===this._type&&"+"===a[c])){a=b.value=a.slice(0,-1),this.inputChanged(a);break}default:b.value=a}this._actionHandler()},b.prototype._checkInput=function(a){switch(this._type){case"tel":case"number":if(this._pattern.test(a))this._inputElement.value=a;else{var b=this._Exception;b.warn(this.type+'\'s value does not satisfy either the given pattern or type. The value will be reset to "".',b.CONTROL),this.inputChanged(this._inputElement.value="",a)}break;default:this._inputElement.value=a}this._actionHandler(),this._actionElement.setAttribute(C,"")},b._inject={_compat:d,_regex:e},b}(plat.ui.BindControl);a.Input=na,plat.register.control(y,na);var oa=function(a){function b(){a.apply(this,arguments),this.templateString='<div class="plat-file-container">\n    <input type="file" class="plat-file-hidden" plat-change="_filesSelected" />\n    <input type="text" class="plat-file-input" plat-keydown="_onKeyDown" />\n    <button class="plat-file-button" plat-tap="_selectFiles"></button>\n</div>\n'}return __extends(b,a),b.prototype.setClasses=function(a,b){this.dom.addClass(b||this.element,z+" "+(a||""))},b.prototype.initialize=function(){this.setClasses()},b.prototype.setTemplate=function(){for(var a,b,c,d=this.element,e=this._hiddenInput=d.firstElementChild.firstElementChild,f=this._visibleInput=e.nextElementSibling,g=f.nextElementSibling,h=this.attributes,i=Object.keys(h),j=i.length,k=plat.dependency.injectors.control,l=/plat-(?:control|hide|context)|class|style/,m=!1,n=this.utils,o=n.isNull,p=n.delimit,q=n.isString,r=0;j>r;++r)a=i[r],b=p(a,"-"),c=h[a],q(c)&&!l.test(b)&&o(k[b])?"multiple"===b?(m=!0,e.setAttribute(b,c)):"disabled"===b?(e.setAttribute(b,c),f.setAttribute(b,c),g.setAttribute(b,c)):e.setAttribute(b,c):b===F&&(e.setAttribute(b,c),f.setAttribute(b,c),g.setAttribute(b,c));if(o(this.innerTemplate))return void(g.textContent=m?"Select files":"Select a file");var s=this.innerTemplate.textContent.replace(/\r|\n/g,"");return n.isEmpty(s)?void(g.textContent=m?"Select files":"Select a file"):void(g.textContent=s)},b.prototype.loaded=function(){var a=this._hiddenInput=this._hiddenInput||this.element.firstElementChild.firstElementChild;this._visibleInput=this._visibleInput||a.nextElementSibling},b.prototype.validate=function(){return!this.utils.isEmpty(this._hiddenInput.value)},b.prototype.clear=function(){var a=this._hiddenInput;if(!this.utils.isEmpty(a.value)){var b=this._hiddenInput=a.cloneNode(!0);this.element.firstElementChild.replaceChild(b,a),this._visibleInput.value="",this.inputChanged(null)}},b.prototype.click=function(){this._selectFiles()},b.prototype.value=function(){var a=this._hiddenInput,b=a.files;if(!this.utils.isNull(b))return a.multiple?Array.prototype.slice.call(b):b[0]},b.prototype.disable=function(){var a="disabled",b=this._visibleInput;this._hiddenInput.setAttribute(a,a),b.setAttribute(a,a),b.nextElementSibling.setAttribute(a,a),this.element.setAttribute(a,a)},b.prototype.enable=function(){var a="disabled",b=this._visibleInput;this._hiddenInput.removeAttribute(a),b.removeAttribute(a),b.nextElementSibling.removeAttribute(a),this.element.removeAttribute(a)},b.prototype.observeProperties=function(a){a.observeProperty(this._setBoundProperty)},b.prototype._setBoundProperty=function(a,b,c,d){var e=this.utils;if(e.isUndefined(a))return void this.inputChanged(null);var f=this._hiddenInput,g=f.files;if(!e.isNull(g))return f.multiple?void this.inputChanged(Array.prototype.slice.call(g)):void(a!==g[0]&&this.inputChanged(g[0]))},b.prototype._onKeyDown=function(a){var b=a.keyCode,c=plat.controls.KeyCodes;return b===c.tab?!0:((b===c.backspace||b===c.delete)&&this.clear(),a.preventDefault(),!1)},b.prototype._selectFiles=function(){this._hiddenInput.click()},b.prototype._filesSelected=function(){var a=this._hiddenInput,b=this._visibleInput,c=a.files;if(!this.utils.isNull(c)){if(!a.multiple){var d=c[0];return b.value=d.name,void this.inputChanged(d)}for(var e=[],f=c.length,g=0;f>g;++g)e.push(c[g].name);b.value=e.join(", "),this.inputChanged(Array.prototype.slice.call(c))}},b._inject={_compat:d},b}(plat.ui.BindControl);a.File=oa,plat.register.control(z,oa);var pa=function(a){function b(){a.apply(this,arguments),this.templateString='<div class="plat-carousel-viewport">\n    <div class="plat-carousel-container"></div>\n</div>\n',this._listeners=[],this._isVertical=!1,this._hasSwiped=!1,this._inTouch=!1,this._hasMoved=!1,this._lastTouch={x:0,y:0},this._loaded=!1,this._index=-1,this._previousIndex=-1,this._nextIndex=-1,this._currentOffset=0,this._removeInterval=aa,this._removeSuspend=aa,this._isAuto=!1,this._isPaused=!1,this._selfPause=!1,this._itemNodes=[],this._removeListeners=[],this._outerStart=!1,this._outerEnd=!1,this._goToIntervalConstant=125}return __extends(b,a),Object.defineProperty(b.prototype,"index",{get:function(){return this._index},enumerable:!0,configurable:!0}),b.prototype.setClasses=function(a,b){this.dom.addClass(b||this.element,A+" "+(a||""))},b.prototype.contextChanged=function(a,b){var c=this,d=this.utils;if(d.isFunction(this._onLoad)){if(d.isEmpty(a))return d.isEmpty(b)||this._Promise.all(this._addQueue).then(function(){c._removeItems(0,c.controls.length)}),void this._verifyLength();if(!d.isArray(a)){var e=this._Exception;return void e.warn(this.type+" context set to something other than an Array.",e.CONTEXT)}return this._executeEvent([{object:a||[],type:"splice"}]),void(d.isArray(a)&&a.length>0&&this._initializeIndex(0))}this.loaded()},b.prototype.initialize=function(){this.setClasses()},b.prototype.setTemplate=function(){var a=this._document.createElement("div");a.className="plat-carousel-item",a.appendChild(this.innerTemplate),this.bindableTemplates.add("item",a)},b.prototype.loaded=function(){var a=this,b=this.utils,c=this.context;if(!b.isArray(c)){var d=this._Exception;return void d.warn("The context of a "+this.type+" must be an Array.",d.CONTEXT)}this._animate=!1;var e=this.options||{},f=e.value||{},g=f.index,h=b.isNumber,i=this._validateOrientation(f.orientation),j=f.interval,k=this._interval=h(j)?Math.abs(j):3e3,m=f.suspend,n=this._viewport=this.element.firstElementChild;this._container=n.firstElementChild,this._type=f.type||"track swipe",this._isInfinite=f.infinite===!0,this._suspend=Math.abs(h(m)?k-m:k-3e3),this.dom.addClass(this.element,l+i),this._onLoad=function(){var b=a._index;g=h(g)&&g>=0?g<c.length?g:c.length-1:null,a._index=0,a._initializeIndex(null===g?b:g),a._addEventListeners(),a.observeArray(a._verifyLength),a._loaded=!0},this._init()},b.prototype.goToNext=function(){var a=this;return this._Promise.all(this._addQueue).then(function(){var b=a._index,c=!1;if(b>=a._itemNodes.length-1&&!(c=a._isInfinite))return a._isAuto&&!a._isPaused&&(a.pause(),a._selfPause=!0),a._Promise.resolve(!1);var d=a._getLength();return d?a._cancelCurrentAnimations().then(function(){a._outerStart&&a._outerEnd||a._initializeOuterNodes();var e={};e[a._transform]=a._calculateStaticTranslation(-d);var f,g=a._initiateAnimation({properties:e});return c?a._index=f=0:f=++a._index,a.inputChanged(a._index,b),g.then(function(){return a._handleNext(f,d),a._checkArrows(),!0})}):a.goToIndex(a._nextIndex,!0)})},b.prototype.goToPrevious=function(){var a=this;return this._Promise.all(this._addQueue).then(function(){var b=a._index,c=!1;if(0>=b&&!(c=a._isInfinite))return a._Promise.resolve(!1);a._selfPause&&a.resume();var d=a._getLength();return d?a._cancelCurrentAnimations().then(function(){a._outerStart&&a._outerEnd||a._initializeOuterNodes();var e={};e[a._transform]=a._calculateStaticTranslation(d);var f,g=a._initiateAnimation({properties:e});return c?a._index=f=a._itemNodes.length-1:f=--a._index,a.inputChanged(a._index,b),g.then(function(){return a._handlePrevious(f,-d),a._checkArrows(),!0})}):a.goToIndex(a._previousIndex,!0)})},b.prototype.goToIndex=function(a,b){var c=this;return this._Promise.all(this._addQueue).then(function(){var d=c._index;return c.utils.isUndefined(d)?(c._initializeIndex(0),c.inputChanged(c._index,a),c._isInfinite||(a<c.context.length-1?c._selfPause&&c.resume():c._isAuto&&!c._isPaused&&(c.pause(),
c._selfPause=!0)),c._Promise.resolve(!0)):a===d?c._Promise.resolve(!1):b===!0?(c._initializeIndex(a),c.inputChanged(c._index,a),c._isInfinite||(a<c.context.length-1?c._selfPause&&c.resume():c._isAuto&&!c._isPaused&&(c.pause(),c._selfPause=!0)),c._Promise.resolve(!0)):a===c._nextIndex?c.goToNext():a===c._previousIndex?c.goToPrevious():c._goToIndex(a)})},b.prototype.pause=function(){this._selfPause=!1,this._isAuto&&!this._isPaused&&(this._isPaused=!0,this._removeSuspend(),this._removeSuspend=aa,this._removeInterval(),this._removeInterval=aa)},b.prototype.resume=function(){this._isAuto&&this._isPaused&&(this._isPaused=this._selfPause=!1,this._initiateInterval())},b.prototype.dispose=function(){a.prototype.dispose.call(this),this._listeners=[],this._removeEventListeners()},b.prototype.onInput=function(a){var b=this._listeners;return b.push(a),function(){var c=b.indexOf(a);-1!==c&&b.splice(c,1)}},b.prototype.inputChanged=function(a,b){if(a!==b)for(var c=this._listeners,d=c.length,e=0;d>e;++e)c[e](a,b)},b.prototype.observeProperties=function(a){a.observeProperty(this._setBoundProperty)},b.prototype._setBoundProperty=function(a,b,c,d){var e=this.utils;if(e.isNull(a)){if(d===!0)return void this.inputChanged(this._index=0,a)}else if(!e.isNumber(a)&&(a=Number(a),!e.isNumber(a))){var f=this._Exception;return void f.warn(this.type+" has it's index bound to a property that cannot be interpreted as a Number.",f.BIND)}return this._loaded?void this.goToIndex(a):void(this._index=a)},b.prototype._reset=function(){var a={};a[this._transform]=this._calculateStaticTranslation(0),this._initiateAnimation({properties:a})},b.prototype._verifyLength=function(){var a=this;this._Promise.all(this._addQueue).then(function(){var b=a.context,c=a._index;if(!a.utils.isArray(b)||0===b.length)return a.utils.isUndefined(c)||a.inputChanged(a._index=void 0,c),a._container.style[a._transform]=a._calculateStaticTranslation(-a._currentOffset),a._removeEventListeners(),void a._checkArrows();if(0===a._removeListeners.length)return a._addEventListeners(),a._initializeIndex(0),void a.inputChanged(0,c);var d=b.length-1;2>d?(a._initializeIndex(c>d?d:c),a.inputChanged(a._index,c)):c>d&&a.goToIndex(d)})},b.prototype._setIndexWindow=function(){var a=this._index,b=this._itemNodes.length-1;0>b?this._previousIndex=this._nextIndex=b:a>=b?(a>b&&(a=this._index=b),this._previousIndex=a-1,this._nextIndex=this._isInfinite?0:-1):0>=a?(0>a&&(a=this._index=0),this._previousIndex=this._isInfinite?b:-1,this._nextIndex=a+1):(this._previousIndex=a-1,this._nextIndex=a+1)},b.prototype._goToIndex=function(a){var b=this._index;if(a===b||0>a||a>=this.context.length)return this._Promise.resolve(!1);if(this._selfPause&&this.resume(),!this._getLength())return this._initializeIndex(a),this._Promise.resolve(!0);var c,d,e,f=this._Promise,g=this.utils.defer;a>b?(c=this.goToNext,d=a-b,this._isInfinite&&(e=this._itemNodes.length-a+b,d>e&&(c=this.goToPrevious,d=e))):(c=this.goToPrevious,d=b-a,this._isInfinite&&(e=this._itemNodes.length-b+a,d>e&&(c=this.goToNext,d=e)));var h=[],i=this._removeListeners,j=this._goToIntervalConstant,k=0;for(c=c.bind(this);--d>0;)h.push(new f(function(a){var b=g(function(){var d=i.indexOf(b);-1!==d&&i.splice(d,1),a(c())},k+=Math.round(j/d));i.push(b)}));return h.push(c()),f.all(h).then(function(a){for(var b=!1;a.length>0&&!(b=b||a.pop()););return b})},b.prototype._handleNext=function(a,b){var c=this._isInfinite;if(c&&this.utils.isNode(this._postClonedNode))return void this._initializeIndex(a);var d=this._itemNodes,e=this._container;this._outerStart?(c||a>1)&&(this.dom.insertBefore(d[this._previousIndex],Array.prototype.slice.call(e.childNodes,0,3)),e.style[this._transform]=this._calculateStaticTranslation(b),e.offsetWidth):this._outerStart=!0,this._setIndexWindow(),(c||a<d.length-1)&&e.insertBefore(d[this._nextIndex],null)},b.prototype._handlePrevious=function(a,b){var c=this._isInfinite;if(c&&this.utils.isNode(this._preClonedNode))return void this._initializeIndex(a);var d=this._itemNodes,e=this._container;this._outerEnd?(c||a<d.length-2)&&this.dom.insertBefore(d[this._nextIndex],Array.prototype.slice.call(e.childNodes,-3)):this._outerEnd=!0,this._setIndexWindow(),(c||a>0)&&(e.insertBefore(d[this._previousIndex],e.firstChild),e.style[this._transform]=this._calculateStaticTranslation(b),e.offsetWidth)},b.prototype._clearInnerNodes=function(){this._removeClones();var a=this._itemNodes;if(0===a.length)return!1;var b=Array.prototype.slice.call(this._container.childNodes),c=this.dom.insertBefore;switch(b.length){case 9:c(a[this._previousIndex],b.slice(0,3));case 6:c(a[this._nextIndex],b.slice(-3));case 3:c(a[this._index],b.slice(0,3))}return!0},b.prototype._initializeIndex=function(a){var b=this._clearInnerNodes();this._itemNodes.length;if(0===this._itemNodes.length?a=-1:0>a&&(a=0),this._index=a,this._setIndexWindow(),!b)return!1;var c=this._container;return c.insertBefore(this._itemNodes[a],null),c.style[this._transform]=this._calculateStaticTranslation(-this._currentOffset),c.offsetWidth,this._initializeOuterNodes(),this._checkArrows(),!0},b.prototype._initializeOuterNodes=function(){var a=this._getLength();if(!a)return void(this._outerStart=this._outerEnd=!1);var b=this._itemNodes,c=this._container,d=b.length;return d>1?(c.insertBefore(b[this._nextIndex],null),this._outerEnd=!0,void(d>2?(this._isInfinite||this._index>0)&&(c.insertBefore(b[this._previousIndex],c.firstChild),c.style[this._transform]=this._calculateStaticTranslation(-a),c.offsetWidth,this._outerStart=!0):this._isInfinite&&this._cloneForInfinite(-a))):void(this._isInfinite&&this._cloneForInfinite(-a))},b.prototype._initiateAnimation=function(a){return this._animationThenable=this._animator.animate(this._container,J,a)},b.prototype._init=function(){var a=this,b=this._addQueue,c=this.context.length;this._setAliases();var d=this._addItems(0,c,0).then(function(){var c=b.indexOf(d);-1!==c&&b.splice(c,1),a._onLoad()}).catch(function(){var b=a._Exception;b.warn("An error occurred while processing the "+a.type+". Please ensure you're context is correct.",b.CONTROL),a._loaded=!1});b.push(d),this._setListener(),this._setTransform()},b.prototype._addEventListeners=function(){var a=this._type.split(" ");-1!==a.indexOf("tap")&&this._initializeTap(),-1!==a.indexOf("swipe")&&this._initializeSwipe(),-1!==a.indexOf("track")&&this._initializeTrack(),-1!==a.indexOf("auto")&&this._initializeAuto()},b.prototype._removeEventListeners=function(){for(var a=this._removeListeners;a.length>0;)a.pop()();this._isAuto&&(this._removeInterval(),this._removeInterval=aa,this._removeSuspend(),this._removeSuspend=aa),this._isInfinite&&this._removeClones()},b.prototype._cloneForInfinite=function(a){this._removeClones();var b=this.context;if(this.utils.isArray(b)&&0!==b.length){var c=this._container,d=this._preClonedNode=c.lastElementChild.cloneNode(!0),e=this._postClonedNode=c.firstElementChild.cloneNode(!0);c.insertBefore(d,c.firstChild),c.insertBefore(e,null),c.style[this._transform]=this._calculateStaticTranslation(a),c.offsetWidth,this._outerStart=this._outerEnd=!0}},b.prototype._removeClones=function(){var a=this._container,b=this._preClonedNode,c=this._postClonedNode,d=this.utils.isNode;d(b)&&a.contains(b)&&a.removeChild(b),d(c)&&a.contains(c)&&a.removeChild(c)},b.prototype._initializeAuto=function(){this._isAuto=!0,this._initiateInterval()},b.prototype._initiateInterval=function(){this._removeInterval=this.utils.setInterval(this.goToNext,this._interval,null,this)},b.prototype._suspendInterval=function(){var a=this;this._isAuto&&!this._isPaused&&(this._removeSuspend(),this._removeInterval(),this._removeSuspend=this.utils.defer(function(){a._initiateInterval(),a._removeSuspend=aa},this._suspend))},b.prototype._initializeTap=function(){var a=this;this.utils.isNode(this._forwardArrow)||this._createArrowElements();var b=this._removeListeners;b.push(this.addEventListener(this._backArrow,M,function(){a._suspendInterval(),a.goToPrevious()},!1)),b.push(this.addEventListener(this._forwardArrow,M,function(){a._suspendInterval(),a.goToNext()},!1)),this._checkArrows()},b.prototype._createArrowElements=function(){var a=this._document,b=this._viewport,c=this._backArrow=a.createElement("div"),d=this._forwardArrow=a.createElement("div"),e=a.createElement("span"),f=a.createElement("span");this._isVertical?(e.className=l+"icon-arrow-up",f.className=l+"icon-arrow-down"):(e.className=l+"icon-arrow-left",f.className=l+"icon-arrow-right"),c.className=l+"back-arrow",d.className=l+"forward-arrow",c.appendChild(e),d.appendChild(f),b.appendChild(c),b.appendChild(d)},b.prototype._checkArrows=function(){var a=this.utils,b=a.isNode;if(!this._isInfinite&&b(this._forwardArrow)&&b(this._backArrow)){var c=this.context.length,d=this._index;if(a.isNull(d))return this._backArrow.setAttribute(C,""),void this._forwardArrow.setAttribute(C,"");0>=d?this._backArrow.setAttribute(C,""):this._backArrow.removeAttribute(C),d>=c-1?this._forwardArrow.setAttribute(C,""):this._forwardArrow.removeAttribute(C)}},b.prototype._initializeSwipe=function(){var a,b,c=this._viewport,d=this._handleSwipe;this._isVertical?(a=Q+"up",b=Q+"down"):(a=Q+"left",b=Q+"right");var e=this._removeListeners;e.push(this.addEventListener(c,a,d,!1)),e.push(this.addEventListener(c,b,d,!1))},b.prototype._initializeTrack=function(){var a,b,c=this._viewport,d=this._track,e=this._touchEnd;this._isVertical?(a=R+"up",b=R+"down"):(a=R+"left",b=R+"right");var f=this._removeListeners;f.push(this.addEventListener(c,a,d,!1)),f.push(this.addEventListener(c,b,d,!1)),f.push(this.addEventListener(c,N,this._touchStart,!1)),f.push(this.addEventListener(c,S,e,!1)),f.push(this.addEventListener(c,O,e,!1))},b.prototype._handleSwipe=function(a){var b=a.direction.primary,c=!1;switch(b){case"left":!this._isVertical&&(this._isInfinite||this._index<this.context.length-1)&&(this._suspendInterval(),c=!0,this.goToNext());break;case"right":!this._isVertical&&(this._isInfinite||this._index>0)&&(this._suspendInterval(),c=!0,this.goToPrevious());break;case"up":this._isVertical&&(this._isInfinite||this._index<this.context.length-1)&&(this._suspendInterval(),c=!0,this.goToNext());break;case"down":this._isVertical&&(this._isInfinite||this._index>0)&&(this._suspendInterval(),c=!0,this.goToPrevious());break;default:return}this._hasSwiped=c},b.prototype._touchStart=function(a){this._inTouch||(this._isAuto&&(this._removeInterval(),this._removeInterval=aa),this._inTouch=!0,this._hasMoved=!1,this._lastTouch={x:a.clientX,y:a.clientY},this._outerStart&&this._outerEnd||this._initializeOuterNodes())},b.prototype._touchEnd=function(a){var b=this,c=this._inTouch,d=this._hasMoved,e=this._hasSwiped;if(this._inTouch=this._hasSwiped=this._hasMoved=!1,c&&!e&&(this._isAuto&&!this._isPaused&&this._initiateInterval(),d)){var f=this._isVertical?a.clientY-this._lastTouch.y:a.clientX-this._lastTouch.x,g=this._getLength();return g&&Math.abs(f)>Math.ceil(g/2)?0>f?void this.goToNext().then(function(a){a||b._reset()}):void this.goToPrevious().then(function(a){a||b._reset()}):void this._reset()}},b.prototype._track=function(a){var b=this;this._inTouch&&(this._hasMoved||this._cancelCurrentAnimations(),this._hasMoved=!0,this.utils.requestAnimationFrame(function(){var c=b._calculateDynamicTranslation(a);null!==c&&(b._container.style[b._transform]=c)}))},b.prototype._calculateStaticTranslation=function(a){return this._isVertical?"translate3d(0,"+(this._currentOffset+=a)+"px,0)":"translate3d("+(this._currentOffset+=a)+"px,0,0)"},b.prototype._calculateDynamicTranslation=function(a){var b;return this._isVertical?(b=a.clientY-this._lastTouch.y,Math.abs(b)>this._getLength()?(this._touchEnd(a),null):"translate3d(0,"+(this._currentOffset+b)+"px,0)"):(b=a.clientX-this._lastTouch.x,Math.abs(b)>this._getLength()?(this._touchEnd(a),null):"translate3d("+(this._currentOffset+b)+"px,0,0)")},b.prototype._setTransform=function(){var a=this._container.style,b=this.utils.isUndefined,c=this._compat.vendorPrefix;b(a[c.lowerCase+"Transform"])?b(a[c.upperCase+"Transform"])?this._transform="transform":this._transform=c.upperCase+"Transform":this._transform=c.lowerCase+"Transform"},b.prototype._getLength=function(){return this._isVertical?this._viewport.offsetHeight:this._viewport.offsetWidth},b.prototype._validateOrientation=function(a){if(this.utils.isUndefined(a))return"horizontal";var b;if("horizontal"===a)b=a;else if("vertical"===a)b=a,this._isVertical=!0;else{var c=this._Exception;c.warn('Invalid orientation "'+a+'" for '+this.type+'. Defaulting to "horizontal."',c.CONTROL),b="horizontal"}return b},b.prototype._appendItems=function(a){this._itemNodes=this._itemNodes.concat(a)},b.prototype._removeItems=function(a,b){for(var c=this._TemplateControlFactory.dispose,d=this.controls,e=this._itemNodes,f=a+b;f-->a;)c(d[f]),e.pop();this._updateResource(d.length-1)},b.prototype._cancelCurrentAnimations=function(){return this.utils.isNull(this._animationThenable)?this._Promise.resolve():this._animationThenable.cancel()},b._inject={_document:g,_window:f,_compat:d,_TemplateControlFactory:j},b}(plat.ui.controls.ForEach);a.Carousel=pa,plat.register.control(A,pa);var qa=function(a){function b(){var b=this;a.call(this),this.templateString='<div class="plat-listview-viewport">\n    <div class="plat-scroll-container">\n        <div class="plat-container"></div>\n    </div>\n</div>\n',this._aliases={index:I.index,even:I.even,odd:I.odd,first:I.first,last:I.last,group:I.group},this._templates={},this._isVertical=!0,this._isLoading=!1,this._scrollPosition=0,this._isRefreshing=!1,this._touchState=0,this._hasMoved=!1,this._lastTouch={x:0,y:0},this._nodeNormalizeRegex=/-|\.|_/g,this._isGrouped=!1,this._cloneAttempts=0,this._maxCloneAttempts=25,this.__listenerSet=!1,this.itemsLoaded=new this._Promise(function(a){b.__resolveFn=a})}return __extends(b,a),b.prototype.setClasses=function(a,b){this.dom.addClass(b||this.element,B+" "+(a||""))},b.prototype.initialize=function(){var a=this.options||(this.options={}),b=a.value||(a.value={});this.templateUrl=this.templateUrl||b.templateUrl,this.setClasses()},b.prototype.setTemplate=function(){if(this.utils.isString(this.templateUrl)){var a=this.dom.serializeHtml(this.templateString),b=this.element;this.innerTemplate=this.dom.appendChildren(b.childNodes),b.appendChild(a)}},b.prototype.contextChanged=function(a,b){var c=this,d=this.utils;if(d.isEmpty(a))this.utils.isEmpty(b)||this._Promise.all(this._defaultGroup.addQueue).then(function(){c._removeItems(0,c.controls.length,c)});else if(!d.isArray(a)){var e=this._Exception;return void e.warn(this.type+" context must be an Array.",e.CONTEXT)}this._setListener(),this._executeEvent([{object:a||[],type:"splice"}])},b.prototype.loaded=function(){var a,b=this.options.value,c=this.utils,d=c.isString,e=this.element,f=this._viewport=e.firstElementChild,g=this._scrollContainer=f.firstElementChild,h=this._loading=b.loading,i=this._animate=b.animate===!0,j=b.onItemsRequested,k=b.onRefresh,m=b.itemTemplate;if(this._container=g.firstElementChild,this.dom.addClass(e,l+this._validateOrientation(b.orientation)+(i?" "+l+"animated":"")),!d(m))return a=this._Exception,void a.warn("No item template or item template selector specified for "+this.type+".",a.TEMPLATE);var n=this._normalizeTemplateName(m),o=b.groupHeaderTemplate,p=d(o)?this._normalizeTemplateName(o):null;this._parseInnerTemplate(n,p),this._determineTemplates(m,n,p),this._defaultGroup={name:null,control:this,itemContainer:this._container,element:e,index:null,itemCount:0,addQueue:[],animationQueue:[]};var q=!1,r=!1;return d(h)&&(d(j)?(q=!0,this._determineLoading(j,b.infiniteProgress!==!1)):(a=this._Exception,a.warn(this.type+' loading type specified as "'+h+'" but no option specifying an onItemsRequested handler.',a.CONTROL))),d(k)&&(r=!0,this._initializeRefresh(k)),this._initializeTracking(q,r),c.isArray(this.context)?(this._setAliases(),this.render(),void this._setListener()):void(c.isNull(this.context)||(a=this._Exception,a.warn(this.type+"'s context must be an Array.",a.CONTEXT)))},b.prototype.dispose=function(){this.__resolveFn=null},b.prototype.render=function(a,b,c){var d=this.utils.isNumber,e=c||this._defaultGroup,f=e.control,g=this===f?this.context:f.context.items;d(a)||(a=0);var h=g.length-a,i=d(b)&&h>=b?b:h;this._createItems(a,i,e,0)},b.prototype.rerender=function(a){this.render(0,null,a)},b.prototype._childContextChanged=function(a,b,c){this._executeChildEvent(a,[{object:b||[],type:"splice"}])},b.prototype._setListener=function(){this.__listenerSet||(this.observeArray(this._executeEvent),this.__listenerSet=!0)},b.prototype._setAliases=function(){var a=this.options.value.aliases,b=this.utils;if(b.isObject(a))for(var c,d=this._aliases,e=b.isString,f=Object.keys(d),g=f.length,h=0;g>h;++h)c=a[f[h]],e(c)&&(d[f[h]]=c)},b.prototype._determineTemplates=function(a,b,c){var d,e,f=this.utils,g=this.bindableTemplates,h=this._templates;if(f.isString(c)&&(this._isGrouped=!0,e=h[c],f.isNode(e)?(this._groupHeaderTemplate=c,this.bindableTemplates.add(c,e),delete h[c]):(d=this._Exception,d.warn(B+' group header template "'+c+'" was not a template defined in the DOM.',d.TEMPLATE)),this._groupHeaderTemplatePromise=this._createGroupTemplate()),e=h[b],f.isNode(e))return this._itemTemplate=b,this.bindableTemplates.add(b,e),void delete h[b];var i=this.findProperty(a)||{};f.isFunction(i.value)||(d=this._Exception,d.warn(B+' item template "'+a+'" was neither a template defined in the DOM nor a template selector function in its control hiearchy.',d.TEMPLATE)),this._templateSelector=i.value.bind(i.control),this._templateSelectorKeys={};for(var j,k=Object.keys(h);k.length>0;)j=k.pop(),g.add(j,h[j]),delete h[j]},b.prototype._createGroupTemplate=function(){var a,b=this,c=this._document,d=(this.options.value,this.bindableTemplates),e=this._groupHeaderTemplate,f=(this._templates[e],B+"-group"),g=c.createElement("div"),h=c.createElement("div");return g.className=f,h.className=B+"-items",this.utils.isString(e)&&(a=d.templates[e].then(function(a){g.insertBefore(a.cloneNode(!0),null)})),this._Promise.resolve(a).then(function(){g.insertBefore(h,null),d.add(f,g)}).then(null,function(a){var c=b._Exception;c.warn(b.type+" error: "+a,c.COMPILE)})},b.prototype._addGroups=function(a,b,c){for(var d,e=this,f=(this.context,b),g=+(b+a),h=[];g>b;)h.push(this._bindGroup(b++));return this._Promise.all(h).then(function(a){var b=a.length;for(d=0;b>d;++d)e._addGroup(d+f,a[d],c>d)})},b.prototype._addGroup=function(b,c,d){var e,f,g=this,h=this.context,i=this._groups||(this._groups={}),j=h[b],k=j.group,l=c.childNodes[1],m=l.lastElementChild,n=this.controls[b],o=i[k]={name:k,index:b,element:l,itemContainer:m,control:n,itemCount:0,addQueue:[],animationQueue:[]},p="items";if(n.dispose=function(){a.prototype.dispose.call(g),delete i[k]},n.observe(function(a,b){var c=a.group;if(c!==k&&g.utils.isObject(a)){var d=i[k];delete i[k],d.name=c,i[c]=d,k=c,e(),f(),e=n.observe(g._childContextChanged.bind(g,k),p),f=n.observeArray(g._executeChildEvent.bind(g,k),p)}}),e=n.observe(this._childContextChanged.bind(this,k),p),f=n.observeArray(this._executeChildEvent.bind(this,k),p),this._createItems(0,(j.items||[]).length,o,0),d){var q=this._defaultGroup.animationQueue;q.push({animation:this._animator.enter(c,K,this._container).then(function(){q.shift(),g._isVertical||g._setItemContainerHeight(m)}),op:null})}else this._container.insertBefore(c,null),this._isVertical||this._setItemContainerHeight(m)},b.prototype._bindGroup=function(a){return this.bindableTemplates.bind(B+"-group",a,this._getAliases(this.context,a))},b.prototype._createItems=function(a,b,c,d){var e=this,f=this.utils,g=c||this._defaultGroup,h=g.control;if(this._isGrouped&&this===h)return void this._groupHeaderTemplatePromise.then(function(){e._addGroups(b,a,d)}).then(null,function(a){var b=e._Exception;b.warn(e.type+" error: "+a,b.CONTROL)});var i=g.addQueue;if(f.isFunction(this._templateSelector)){var j=[];g.itemCount+=b;for(var k=0;b>k;++k,++a)j.push(this._renderUsingFunction(a,g,d>k));var l=this._Promise.all(j).then(function(){var a=i.indexOf(n);-1!==a&&i.splice(a,1),e._isVertical||e._setItemContainerWidth(g.itemContainer)});return i.push(l),void(this.itemsLoaded=l)}var m=this._itemTemplate;if(!f.isUndefined(this.bindableTemplates.templates[m])){this._disposeFromIndex(a,g),g.itemCount+=b;var n=this._addItems(a,b,g,d).then(function(){var a=i.indexOf(n);-1!==a&&i.splice(a,1),e._isVertical||e._setItemContainerWidth(g.itemContainer)});i.push(n)}},b.prototype._addItems=function(a,b,c,d){var e,f,g=this,h=c||this._defaultGroup,i=h.control,j=h.itemContainer,k=+(a+b),l=[],m=this._itemTemplate,n=i.bindableTemplates,o=a;for(this===i?(e="",f=this.context):(e="items.",f=i.context.items);k>a;)l.push(n.bind(m,e+a,this._getAliases(f,a++)));return l.length>0&&(this.itemsLoaded=this._Promise.all(l).then(function(a){if(d>0)for(var b=a.length,c=0;b>c;++c)d>c?g._appendAnimatedItem(a[c],h):j.insertBefore(a[c],null);else g._appendItems(a,j);g._updateResource(o-1,i),g.utils.isFunction(g.__resolveFn)&&(g.__resolveFn(),g.__resolveFn=null)}).catch(function(a){g.utils.postpone(function(){var b=g._Exception;b.warn(a,b.BIND)})})),this.itemsLoaded},b.prototype._renderUsingFunction=function(a,b,c){var d,e,f=this,g=this._Promise,h=this.utils,i=b||this._defaultGroup,j=i.control;return this===j?(d=a,e=this.context):(d="items."+a,e=j.context.items),g.resolve(this._templateSelectorPromise).then(function(){return f._templateSelectorPromise=g.resolve(f._templateSelector(e[a],a))}).then(function(b){var c=j.bindableTemplates,g=c.templates,k=j.controls,l=f._normalizeTemplateName(b),m=i.name,n=f._templateSelectorKeys[m],o=a<k.length;if(h.isUndefined(n)&&(n=f._templateSelectorKeys[m]={}),!h.isUndefined(g[l])){if(o){if(l===n[a])return;return n[a]=l,c.replace(a,l,d,f._getAliases(e,a))}return n[a]=l,c.bind(l,d,f._getAliases(e,a))}o&&f._TemplateControlFactory.dispose(k[a])}).then(function(a){if(!h.isNull(a)&&!h.isArray(a)){if(c===!0){var b=i.animationQueue;return void b.push({animation:f._animator.enter(a,K,i.itemContainer).then(function(){b.shift()}),op:null})}i.itemContainer.insertBefore(a,null)}}).then(null,function(a){var b=f._Exception;b.warn(f.type+" error: "+a,b.CONTROL)})},b.prototype._updateResource=function(a,b){var c=b.controls;0>a||a>=c.length||c[a].resources.add(this._getAliases(this===b?this.context:b.context.items,a))},b.prototype._getAliases=function(a,b){var c=0===(1&b),d={},e=this._aliases,f=$;return d[e.index]={value:b,type:f},d[e.even]={value:c,type:f},d[e.odd]={value:!c,type:f},d[e.first]={value:0===b,type:f},d[e.last]={value:b===a.length-1,type:f},d},b.prototype._appendItems=function(a,b){this.dom.appendChildren(a,b)},b.prototype._appendAnimatedItem=function(a,b){if(this.utils.isNode(a)){var c=b.animationQueue;c.push({animation:this._animator.enter(a,K,b.itemContainer).then(function(){c.shift()}),op:null})}},b.prototype._removeItems=function(a,b,c){for(var d=this._TemplateControlFactory.dispose,e=c.controls,f=a+b;f-->a;)d(e[f]);this._updateResource(e.length-1,c)},b.prototype._disposeFromIndex=function(a,b){for(var c=(b||this._defaultGroup).control.controls,d=this._TemplateControlFactory.dispose,e=c.length-1;e>=a;--e)d(c[e])},b.prototype._determineLoading=function(a,b){var c=this,d=this.findProperty(a)||{};if(!this.utils.isFunction(d.value)){var e=this._Exception;return void e.warn(B+' onItemsRequested function "'+a+'" was not found.',e.CONTROL)}this._requestItems=d.value.bind(d.control);var f;switch(this._loading){case"infinite":this._removeScroll=this.addEventListener(this._scrollContainer,"scroll",this._onScroll,!1),b&&(f=this._loadingProgressRing=this._document.createElement("div"),f.className="plat-infinite",f.insertBefore(this._generateProgressRing(),null)),this.itemsLoaded.then(function(){c._handleScroll()});break;case"incremental":f=this._loadingProgressRing=this._document.createElement("div"),f.className="plat-incremental",f.setAttribute(C,""),f.insertBefore(this._generateProgressRing(),null),this.element.insertBefore(f,null)}},b.prototype._onScroll=function(a){var b=this._scrollContainer,c=this._scrollPosition,d=this._isVertical?b.scrollTop+b.offsetHeight:b.scrollLeft+b.offsetWidth;return c>d?void(this._scrollPosition=d):void(c+5>d||(this._scrollPosition=d,this._handleScroll()))},b.prototype._handleScroll=function(){var a=this,b=this._scrollContainer,c=.8*(this._isVertical?b.scrollHeight:b.scrollWidth),d=this.utils;if(0!==c&&this._scrollPosition>=c){var e=this._requestItems();if(e===!1)this._removeScroll();else if(d.isPromise(e)){var f=this._loadingProgressRing,g=!d.isNull(f),h=this._container;this._removeScroll(),g&&d.requestAnimationFrame(function(){h.insertBefore(f,null)}),e.then(function(c){g&&d.requestAnimationFrame(function(){h.removeChild(f)}),c!==!1&&(a._removeScroll=a.addEventListener(b,"scroll",a._onScroll,!1))})}}},b.prototype._initializeRefresh=function(a){var b=this.findProperty(a)||{};if(!this.utils.isFunction(b.value)){var c=this._Exception;return void c.warn(B+' onRefresh function "'+a+'" was not found.',c.CONTROL)}this._refresh=b.value.bind(b.control);var d=this._refreshProgressRing=this._document.createElement("div");d.className="plat-refresh",d.setAttribute(C,""),d.insertBefore(this._generateProgressRing(),null),this.element.insertBefore(d,null)},b.prototype._initializeTracking=function(a,b){if(a||b){this._setTransform();var c,d;this._isVertical?(c=R+"down",d=R+"up"):(c=R+"right",d=R+"left");var e,f,g=this._viewport;this.addEventListener(g,N,this._touchStart,!1),a&&(e=this._touchEndLoad,f=this._trackLoad,this.addEventListener(g,O,e,!1),this.addEventListener(g,S,e,!1),this.addEventListener(g,P,e,!1),this.addEventListener(g,c,f,!1),this.addEventListener(g,d,f,!1)),b&&(e=this._touchEndRefresh,f=this._trackRefresh,this.addEventListener(g,O,e,!1),this.addEventListener(g,S,e,!1),this.addEventListener(g,P,e,!1),this.addEventListener(g,c,f,!1),this.addEventListener(g,d,f,!1))}},b.prototype._touchStart=function(a){var b=this;if(0===this._touchState){if(!this._isVertical){var c=Math.ceil(a.offsetY),d=this._viewport.offsetHeight-20;if(c>=d)return}return this._touchState=1,this._lastTouch={x:a.clientX,y:a.clientY},this.utils.isNull(this._touchAnimationThenable)?void(this._touchState=2):void this._touchAnimationThenable.cancel().then(function(){b._touchAnimationThenable=null,b._touchState=2})}},b.prototype._touchEndLoad=function(a){var b=this._isLoading;if(this._isLoading=!1,!b)return void(this._isRefreshing||(this._touchState=0));var c,d,e=this._scrollContainer;return this._isVertical?(c=e.scrollTop+e.offsetHeight,d=e.scrollHeight):(c=e.scrollLeft+e.offsetWidth,d=e.scrollWidth),d>c+1?void(this._touchState=0):void this._touchEnd(a,!1)},b.prototype._touchEndRefresh=function(a){var b=this._isRefreshing;return this._isRefreshing=!1,b?(this._isVertical?this._scrollContainer.scrollTop:this._scrollContainer.scrollLeft)>0?void(this._touchState=0):void this._touchEnd(a,!0):void(this._isLoading||(this._touchState=0))},b.prototype._touchEnd=function(a,b){var c=this,d=this._touchState,e=this._hasMoved;if(this._hasMoved=!1,!(2>d)&&e){var f,g={},h=this.dom,i=this._viewport,j=b?this._refreshProgressRing:this._loadingProgressRing,k=3===d;if(k){var m;this._isVertical?(m=b?j.offsetHeight:-j.offsetHeight,f="translate3d(0,"+m+"px,0)"):(m=b?j.offsetWidth:-j.offsetWidth,f="translate3d("+m+"px,0,0)")}else f=this._preTransform;g[this._transform]=f,this._touchAnimationThenable=this._animator.animate(i,J,{properties:g}).then(function(){return c._touchState=4,c._hasMoved=!1,c._touchAnimationThenable=null,k?c._Promise.resolve(b?c._refresh():c._requestItems()):(h.removeClass(i,l+"manipulation-prep"),j.setAttribute(C,""),c._Promise.resolve())}).then(function(){return k?(h.removeClass(j,l+"play"),g[c._transform]=c._preTransform,c._touchAnimationThenable=c._animator.animate(i,J,{properties:g}).then(function(){c._touchState=0,c._touchAnimationThenable=null,h.removeClass(i,l+"manipulation-prep"),j.setAttribute(C,"")})):void(c._touchState=0)}).then(null,function(a){c._touchState=0;var b=c._Exception;b.warn(c.type+"error: "+a,b.CONTROL)})}},b.prototype._trackLoad=function(a){if(!this._isRefreshing){if(!this._isLoading){var b,c,d=this._scrollContainer;if(this._isVertical){if("up"!==a.direction.y)return;b=d.scrollTop+d.offsetHeight,c=d.scrollHeight}else{if("left"!==a.direction.x)return;b=d.scrollLeft+d.offsetWidth,c=d.scrollWidth}if(c>b+1)return;this._isLoading=!0}this._track(a,!1)}},b.prototype._trackRefresh=function(a){if(!this._isLoading){if(!this._isRefreshing){if(this._isVertical){if("down"!==a.direction.y||this._scrollContainer.scrollTop>0)return}else if("right"!==a.direction.x||this._scrollContainer.scrollLeft>0)return;this._isRefreshing=!0}this._track(a,!0)}},b.prototype._track=function(a,b){var c=this,d=this._touchState;if(2===d||3===d){var e=this._calculateTranslation(a,b);this.utils.requestAnimationFrame(function(){c._viewport.style[c._transform]=e})}},b.prototype._calculateTranslation=function(a,b){var c,d,e=this._isVertical,f=b?this._refreshProgressRing:this._loadingProgressRing;return e?(c=a.clientY-this._lastTouch.y,d=f.offsetHeight):(c=a.clientX-this._lastTouch.x,d=f.offsetWidth),b&&0>c||!b&&c>0?c=0:this._hasMoved?Math.abs(c)>=d?this._touchState<3&&(this._touchState=3,this.dom.addClass(f,l+"play")):3===this._touchState&&(this._touchState=2,this.dom.removeClass(f,l+"play")):(this._hasMoved=!0,this.dom.addClass(this._viewport,l+"manipulation-prep"),f.removeAttribute(C)),e?"translate3d(0,"+c+"px,0)":"translate3d("+c+"px,0,0)"},b.prototype._setTransform=function(){var a=this._viewport.style,b=this.utils.isUndefined,c=this._compat.vendorPrefix;b(this._preTransform=a[c.lowerCase+"Transform"])?b(this._preTransform=a[c.upperCase+"Transform"])?(this._preTransform=a.transform,this._transform="transform"):this._transform=c.upperCase+"Transform":this._transform=c.lowerCase+"Transform"},b.prototype._parseInnerTemplate=function(a,b){for(var c,d,e,f=this._templates,g=Array.prototype.slice,h=this.dom.appendChildren,i=this._document,j=!this.utils.isNull(b),k=g.call(this.innerTemplate.childNodes),m=(k.length,l+"item"),n=l+"header";k.length>0;)c=k.pop(),c.nodeType===Node.ELEMENT_NODE&&(d=this._normalizeTemplateName(c.nodeName),j&&d===b?(e=i.createElement("div"),e.className=n):(e=i.createElement("div"),e.className=m),e=h(c.childNodes,e),f[d]=e)},b.prototype._executeEvent=function(a){var b="_"+a[0].type;this.utils.isFunction(this[b])&&this[b](a)},b.prototype._executeChildEvent=function(a,b){var c=this.utils,d="_"+b[0].type;if(c.isFunction(this[d])){var e=this._groups[a];if(c.isNull(e))return;this[d](b,e)}},b.prototype._push=function(a,b){var c=a[0],d=c.addedCount;this._createItems(c.index,d,b,this._animate?d:0)},b.prototype._pop=function(a,b){var c=this,d=b||this._defaultGroup,e=d.addQueue,f=a[0],g=f.object.length;if(0!==f.removed.length){var h=f.object.length;d.itemCount>0&&d.itemCount--,this._Promise.all(e).then(function(){return c._animate?void c._animateItems(g,1,L,d,"leave",!1).then(function(){c._removeItems(h,1,d.control)}):void c._removeItems(h,1,d.control)})}},b.prototype._unshift=function(a,b){if(this.utils.isFunction(this._templateSelector))return void this.rerender(b);var c=b||this._defaultGroup,d=a[0],e=d.addedCount;if(this._animate){var f=c.animationQueue,g=f.length;this._animateItems(0,e,K,c,null,g>0&&"clone"===f[g-1].op)}this._createItems(d.object.length-e,e,c,0)},b.prototype._shift=function(a,b){var c=this,d=b||this._defaultGroup,e=d.addQueue,f=a[0];if(0!==f.removed.length){if(this._animate&&0===e.length){d.animationQueue;e=e.concat([this._animateItems(0,1,L,d,"clone",!0)])}var g=f.object.length;d.itemCount>0&&d.itemCount--,this._Promise.all(e).then(function(){c._removeItems(g,1,d.control)})}},b.prototype._splice=function(a,b){var c=this,d=this.utils,e=a[0],f=b||this._defaultGroup,g=e.addedCount,h=f.itemCount,i=f.control,j=f.addQueue,k=this._animate;if(d.isNull(g)){k&&this._cancelCurrentAnimations();var l=e.object.length,m=h-l;if(l>h){if(d.isFunction(this._templateSelector))return void(d.isNull(e.index)?this.rerender(f):this.render(e.index,g,f));
this._createItems(h,-m,f,0)}else h>l&&(f.itemCount>=m?f.itemCount-=m:f.itemCount=0,this._Promise.all(j).then(function(){c._removeItems(h-m,m,i)}))}else{var n=e.removed.length,o=f.animationQueue;if(g>n){var p,q=(this._Promise,g-n);if(d.isFunction(this._templateSelector))return void(d.isNull(e.index)?this.rerender(f):this.render(e.index,g,f));if(k){p=g;var r=o.length,s=e.index;g-s>h&&(p=h-s),this._animateItems(s,p,K,f,null,r>0&&"clone"===o[r-1].op),p=g-p}else p=0;this._createItems(e.object.length-q,q,f,p)}else if(n>g){var t=g>0;k&&!t&&0===j.length&&(j=j.concat([this._animateItems(e.index,n,L,f,"clone",!0)]));var u=n-g;f.itemCount>=u?f.itemCount-=u:f.itemCount=0,this._Promise.all(j).then(function(){if(k&&t){var a=o.length;c._animateItems(e.index,g,K,f,null,a>0&&"clone"===o[a-1].op)}c._removeItems(h-u,u,i)})}}},b.prototype._animateItems=function(a,b,c,d,e,f){var g=3,h=a*g;switch(e){case"clone":return this._handleClonedContainerAnimation(h,b*g+h,c,d,f===!0);case"leave":return this._handleLeave(h,b*g+h,c,d);default:return this._handleSimpleAnimation(h,b*g+h,c,d,f===!0)}},b.prototype._handleSimpleAnimation=function(a,b,c,d,e){var f=d.itemContainer,g=Array.prototype.slice,h=g.call(f.childNodes,a,b);if(0===h.length)return this._Promise.resolve();var i=d.animationQueue,j=this._animator.create(h,c),k=j.current.then(function(){i.shift()}),l=function(){return j.previous.then(function(){k.start()}),k};if(e&&i.length>0){var m=this._cancelCurrentAnimations().then(l);return i.push({animation:k,op:null}),m}return i.push({animation:k,op:null}),l()},b.prototype._handleLeave=function(a,b,c,d){var e=d.itemContainer,f=Array.prototype.slice,g=f.call(e.childNodes,a,b);if(0===g.length)return this._Promise.resolve();var h=d.animationQueue,i=this._animator.leave(g,c).then(function(){h.shift()});return h.push({animation:i,op:"leave"}),i},b.prototype._handleClonedContainerAnimation=function(a,b,c,d,e){var f=d.itemContainer,g=f.cloneNode(!0),h=Array.prototype.slice,i=h.call(g.childNodes,a,b);if(0===i.length)return this._Promise.resolve();var j,k=d.animationQueue,l=this.utils.isNull,m=this._animator.create(i,c),n=m.current.then(function(){k.shift(),l(j)||j.replaceChild(f,g)}),o=function(){return j=f.parentNode,l(j)||n.isCanceled()?(k.shift(),n):(j.replaceChild(g,f),m.previous.then(function(){n.start()}),n)};if(e&&k.length>0){var p=this._cancelCurrentAnimations().then(o);return k.push({animation:n,op:"clone"}),p}return k.push({animation:n,op:"clone"}),o()},b.prototype._cancelCurrentAnimations=function(a){for(var b=(a||this._defaultGroup).animationQueue,c=[],d=b.length,e=0;d>e;++e)c.push(b[e].animation.cancel());return this._Promise.all(c)},b.prototype._normalizeTemplateName=function(a){return this.utils.isString(a)?a.toLowerCase().replace(this._nodeNormalizeRegex,""):void 0},b.prototype._generateProgressRing=function(){var a=this._document,b=a.createElement("div"),c=a.createElement("div"),d=a.createElement("div");return d.className="plat-animated-ring",c.insertBefore(d,null),c.className="plat-progress-container",b.insertBefore(c,null),b.className="plat-ring",b},b.prototype._validateOrientation=function(a){if(this.utils.isUndefined(a))return"vertical";var b;if("vertical"===a)b=a;else if("horizontal"===a)b=a,this._isVertical=!1;else{var c=this._Exception;c.warn('Invalid orientation "'+a+'" for '+this.type+'. Defaulting to "vertical."',c.CONTROL),b="vertical"}return b},b.prototype._setItemContainerWidth=function(a){var b=a.scrollWidth;return b?void(a.style.width=b+"px"):void this._setItemContainerWidthWithClone(a)},b.prototype._setItemContainerWidthWithClone=function(a){var b,c=this._document.body,d=a.parentElement,e=d.lastElementChild;if(!c.contains(d)){var f=++this._cloneAttempts;if(f===this._maxCloneAttempts){var g=this.type;return b=this._Exception,b.warn("Max clone attempts reached before the "+g+" was placed into the DOM. Disposing of the "+g+".",b.CONTROL),void this._TemplateControlFactory.dispose(this)}return void this.utils.defer(this._setItemContainerWidthWithClone,20,[a],this)}this._cloneAttempts=0;var h,i,j=d.cloneNode(!0),k=j.lastElementChild,l=/\d+(?!\d+|%)/,m=this._window,n=[],o=k,p="width",q="height",r="important",s=this.utils.isNull;if(o.id="",!l.test(i=(h=m.getComputedStyle(e))[p]))for("none"===h.display&&o.style.setProperty("display","block",r),o.style.setProperty(p,i,r),o.style.setProperty(q,h.height,r),e=e.parentElement,o=j,o.id="";!l.test(i=(h=m.getComputedStyle(e))[p]);){if("none"===h.display&&o.style.setProperty("display","block",r),o.style.setProperty(p,i,r),o.style.setProperty(q,h.height,r),e=e.parentElement,s(e))return b=this._Exception,b.warn("The document's body contains a "+this.type+" that needs its length and is currently hidden. Please do not set the body's display to none.",b.CONTROL),void this.utils.defer(this._setItemContainerWidthWithClone,100,[p],this);o=e.cloneNode(!1),o.id="",n.push(o)}if(n.length>0){var t,u=n.pop();for(u.style;n.length>0;)t=n.pop(),u.insertBefore(t,null),u=t;u.insertBefore(j,null)}var v=o.style;v.setProperty(p,i,r),v.setProperty(q,h.height,r),v.setProperty("visibility","hidden",r),c.appendChild(o),a.style.width=k.scrollWidth+"px",c.removeChild(o)},b.prototype._setItemContainerHeight=function(a){var b=a.parentElement,c=b.offsetHeight,d=b.firstElementChild.offsetHeight;return c&&d?void(a.style.height=c-d-15+"px"):void this._setItemContainerHeightWithClone(a)},b.prototype._setItemContainerHeightWithClone=function(a){var b,c=this._document.body,d=a.parentElement,e=d.firstElementChild;if(!c.contains(d)){var f=++this._cloneAttempts;if(f===this._maxCloneAttempts){var g=this.type;return b=this._Exception,b.warn("Max clone attempts reached before the "+g+" was placed into the DOM. Disposing of the "+g+".",b.CONTROL),void this._TemplateControlFactory.dispose(this)}return void this.utils.defer(this._setItemContainerHeightWithClone,20,[a],this)}this._cloneAttempts=0;var h,i,j=d.cloneNode(!0),k=j.firstElementChild,l=/\d+(?!\d+|%)/,m=this._window,n=[],o=k,p="height",q="important",r=this.utils.isNull;if(o.id="",!l.test(i=(h=m.getComputedStyle(e))[p]))for("none"===h.display&&o.style.setProperty("display","block",q),o.style.setProperty(p,i,q),e=e.parentElement,o=j,o.id="";!l.test(i=(h=m.getComputedStyle(e))[p]);){if("none"===h.display&&o.style.setProperty("display","block",q),o.style.setProperty(p,i,q),e=e.parentElement,r(e))return b=this._Exception,b.warn("The document's body contains a "+this.type+" that needs its length and is currently hidden. Please do not set the body's display to none.",b.CONTROL),void this.utils.defer(this._setItemContainerHeightWithClone,100,[p],this);o=e.cloneNode(!1),o.id="",n.push(o)}if(n.length>0){var s,t=n.pop();for(t.style;n.length>0;)s=n.pop(),t.insertBefore(s,null),t=s;t.insertBefore(j,null)}var u=o.style;u.setProperty(p,i,q),u.setProperty("visibility","hidden",q),c.appendChild(o),a.style.height=j.offsetHeight-k.offsetHeight-15+"px",c.removeChild(o)},b._inject={_document:g,_window:f,_compat:d,_animator:h,_Promise:c,_TemplateControlFactory:j},b}(plat.ui.TemplateControl);a.Listview=qa,plat.register.control(B,qa)}(platui||(platui={})),module.exports=platui;